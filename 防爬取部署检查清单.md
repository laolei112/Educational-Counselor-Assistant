# é˜²çˆ¬å–åŠŸèƒ½éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### 1. å¯†é’¥é…ç½® âš ï¸ **æœ€é‡è¦**

- [ ] å·²ç”Ÿæˆå¼ºéšæœºå¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰
  ```bash
  python3 -c "import secrets; print(secrets.token_urlsafe(32))"
  ```

- [ ] å‰ç«¯ `.env` æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®å¯†é’¥
  ```bash
  # frontend/.env
  VITE_API_SECRET=ä½ çš„å¯†é’¥
  VITE_API_KEY=web-client-v1
  ```

- [ ] åç«¯ç¯å¢ƒå˜é‡å·²é…ç½®å¯†é’¥
  ```yaml
  # docker-compose.yml
  environment:
    - API_SECRET=ä½ çš„å¯†é’¥
  ```

- [ ] **å‰åç«¯å¯†é’¥å®Œå…¨ä¸€è‡´**ï¼ˆè¿™æ˜¯æœ€å¸¸è§çš„é”™è¯¯ï¼ï¼‰

### 2. HTTPSé…ç½®

- [ ] SSLè¯ä¹¦å·²å‡†å¤‡
  - [ ] è¯ä¹¦æ–‡ä»¶: `/etc/nginx/ssl/betterschool.hk_bundle.crt`
  - [ ] ç§é’¥æ–‡ä»¶: `/etc/nginx/ssl/betterschool.hk.key`

- [ ] Nginxé…ç½®å·²æ›´æ–°
  - [ ] 80ç«¯å£é‡å®šå‘åˆ°443
  - [ ] 443ç«¯å£SSLé…ç½®æ­£ç¡®
  - [ ] è¯ä¹¦è·¯å¾„æ­£ç¡®

- [ ] Dockerç«¯å£æ˜ å°„
  ```yaml
  nginx:
    ports:
      - "80:80"
      - "443:443"  # ç¡®ä¿æ˜ å°„äº†443ç«¯å£
  ```

### 3. ä¸­é—´ä»¶é…ç½®

- [ ] å·²å¯ç”¨æ‰€æœ‰é˜²æŠ¤ä¸­é—´ä»¶
  ```python
  # backend/backend/basic_settings.py
  MIDDLEWARE = [
      # ...
      "backend.middleware.RateLimitMiddleware.RateLimitMiddleware",
      "backend.middleware.AntiCrawlerMiddleware.AntiCrawlerMiddleware",
      "backend.middleware.SignatureMiddleware.SignatureMiddleware",
  ]
  ```

- [ ] CORSé…ç½®åŒ…å«è‡ªå®šä¹‰è¯·æ±‚å¤´
  ```python
  CORS_ALLOW_HEADERS = (
      # ...
      'x-api-key',
      'x-timestamp',
      'x-nonce',
      'x-signature',
      'x-device-id',
  )
  ```

- [ ] å„ä¸­é—´ä»¶å¼€å…³çŠ¶æ€ç¡®è®¤
  - [ ] SignatureMiddleware: `ENABLE_SIGNATURE_CHECK = True`
  - [ ] RateLimitMiddleware: `ENABLE_RATE_LIMIT = True`
  - [ ] AntiCrawlerMiddleware: `ENABLE_ANTI_CRAWLER = True`

### 4. ä»£ç æ–‡ä»¶æ£€æŸ¥

**å‰ç«¯æ–‡ä»¶ï¼š**
- [ ] `frontend/src/utils/crypto.ts` - åŠ å¯†å·¥å…·ç±»
- [ ] `frontend/src/api/request.ts` - å·²é›†æˆç­¾åæœºåˆ¶
- [ ] `frontend/.env` - ç¯å¢ƒå˜é‡é…ç½®

**åç«¯æ–‡ä»¶ï¼š**
- [ ] `backend/utils/crypto_utils.py` - ç­¾åéªŒè¯å’Œé¢‘ç‡é™åˆ¶
- [ ] `backend/backend/middleware/SignatureMiddleware.py` - ç­¾åä¸­é—´ä»¶
- [ ] `backend/backend/middleware/RateLimitMiddleware.py` - é¢‘ç‡é™åˆ¶ä¸­é—´ä»¶
- [ ] `backend/backend/middleware/AntiCrawlerMiddleware.py` - åçˆ¬è™«ä¸­é—´ä»¶
- [ ] `backend/backend/basic_settings.py` - ä¸­é—´ä»¶é…ç½®

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: æ„å»ºå‰ç«¯
```bash
cd frontend
npm install
npm run build
```

### æ­¥éª¤2: æ„å»ºåç«¯
```bash
cd backend
pip install -r requirements.txt
```

### æ­¥éª¤3: å¯åŠ¨æœåŠ¡
```bash
# åœæ­¢æ—§æœåŠ¡
docker-compose down

# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆçº¦30ç§’ï¼‰
sleep 30
```

### æ­¥éª¤4: æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# åº”è¯¥çœ‹åˆ°æ‰€æœ‰æœåŠ¡éƒ½æ˜¯ Up çŠ¶æ€
```

## âœ… åŠŸèƒ½éªŒè¯

### æµ‹è¯•1: æµè§ˆå™¨æ­£å¸¸è®¿é—®
```
æ‰“å¼€æµè§ˆå™¨è®¿é—®: https://yourdomain.com
é¢„æœŸ: æ­£å¸¸æ˜¾ç¤ºé¡µé¢ï¼Œå¯ä»¥æœç´¢å’ŒæŸ¥çœ‹å­¦æ ¡ä¿¡æ¯
```

### æµ‹è¯•2: æœªç­¾åè¯·æ±‚è¢«æ‹’ç»
```bash
curl https://yourdomain.com/api/schools/primary

é¢„æœŸè¾“å‡º:
{"code": 403, "message": "ç­¾åéªŒè¯å¤±è´¥: ç¼ºå°‘å¿…è¦çš„ç­¾åå‚æ•°", "success": false}
```

### æµ‹è¯•3: çˆ¬è™«è¢«è¯†åˆ«
```bash
curl -H "User-Agent: python-requests/2.28.0" https://yourdomain.com/api/schools/primary

é¢„æœŸè¾“å‡º:
{"code": 403, "message": "è®¿é—®è¢«æ‹’ç»", "success": false}
```

### æµ‹è¯•4: é¢‘ç‡é™åˆ¶ç”Ÿæ•ˆ
```bash
# å¿«é€Ÿå‘é€å¤šä¸ªè¯·æ±‚
for i in {1..110}; do curl -s https://yourdomain.com/api/schools/primary; done

é¢„æœŸ: å‰100ä¸ªè¯·æ±‚æ­£å¸¸ï¼Œåç»­è¿”å›429é”™è¯¯
```

### æµ‹è¯•5: æŸ¥çœ‹æ—¥å¿—
```bash
docker-compose logs backend | tail -50

é¢„æœŸ: èƒ½çœ‹åˆ°å„ç§æ‹¦æˆªæ—¥å¿—
```

## ğŸ“Š ç›‘æ§æ£€æŸ¥

### æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend

# æŸ¥çœ‹æ‹¦æˆªç»Ÿè®¡
docker-compose exec backend grep -c "ç­¾åéªŒè¯å¤±è´¥\|é¢‘ç‡é™åˆ¶\|çˆ¬è™«" /app/log/backend.log

# æŸ¥çœ‹æœ€è¿‘çš„æ‹¦æˆª
docker-compose exec backend tail -100 /app/log/backend.log | grep -E "(403|429)"
```

### æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹å“åº”æ—¶é—´ï¼ˆåº”è¯¥åªå¢åŠ 5-10msï¼‰
curl -w "@curl-format.txt" -o /dev/null -s https://yourdomain.com/api/schools/primary

# curl-format.txt å†…å®¹ï¼š
# time_namelookup:  %{time_namelookup}\n
# time_connect:  %{time_connect}\n
# time_starttransfer:  %{time_starttransfer}\n
# time_total:  %{time_total}\n
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜æ£€æŸ¥æ¸…å•

**å¦‚æœæµè§ˆå™¨è®¿é—®å¤±è´¥ï¼ˆ403ï¼‰ï¼š**
- [ ] æ£€æŸ¥å‰ç«¯.envæ–‡ä»¶æ˜¯å¦å­˜åœ¨
- [ ] æ£€æŸ¥å‰åç«¯å¯†é’¥æ˜¯å¦ä¸€è‡´
- [ ] æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JSé”™è¯¯
- [ ] æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦åŒ…å«ç­¾åä¿¡æ¯ï¼ˆå¼€å‘è€…å·¥å…· > Networkï¼‰

**å¦‚æœSSLè¯ä¹¦é”™è¯¯ï¼š**
- [ ] æ£€æŸ¥è¯ä¹¦æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- [ ] æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æƒé™ï¼ˆåº”è¯¥å¯è¯»ï¼‰
- [ ] æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ
- [ ] æ£€æŸ¥åŸŸåæ˜¯å¦åŒ¹é…

**å¦‚æœæ€§èƒ½ä¸‹é™æ˜æ˜¾ï¼š**
- [ ] æ£€æŸ¥æ˜¯å¦å¼€å¯äº†è¿‡å¤šçš„æ—¥å¿—
- [ ] è€ƒè™‘ä½¿ç”¨Rediså­˜å‚¨é¢‘ç‡é™åˆ¶æ•°æ®
- [ ] æ£€æŸ¥ä¸­é—´ä»¶é¡ºåºæ˜¯å¦åˆç†

**å¦‚æœæ—¥å¿—æ²¡æœ‰æ‹¦æˆªè®°å½•ï¼š**
- [ ] æ£€æŸ¥ä¸­é—´ä»¶æ˜¯å¦æ­£ç¡®å¯ç”¨
- [ ] æ£€æŸ¥æ—¥å¿—é…ç½®æ˜¯å¦æ­£ç¡®
- [ ] æ£€æŸ¥ç™½åå•é…ç½®æ˜¯å¦è¿‡äºå®½æ¾

## ğŸ”’ å®‰å…¨åŠ å›ºå»ºè®®

### ç”Ÿäº§ç¯å¢ƒå¿…åš
- [ ] ä½¿ç”¨å¼ºéšæœºå¯†é’¥ï¼ˆä¸ä½¿ç”¨é»˜è®¤å¯†é’¥ï¼‰
- [ ] å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’ï¼ˆä¸ç¡¬ç¼–ç ï¼‰
- [ ] å¼ºåˆ¶ä½¿ç”¨HTTPSï¼ˆå·²é…ç½®ï¼‰
- [ ] å®šæœŸè½®æ¢å¯†é’¥ï¼ˆå»ºè®®æ¯å­£åº¦ä¸€æ¬¡ï¼‰

### å»ºè®®é…ç½®
- [ ] ä½¿ç”¨Rediså­˜å‚¨é¢‘ç‡é™åˆ¶æ•°æ®
- [ ] é…ç½®æ—¥å¿—å‘Šè­¦ï¼ˆæ‹¦æˆªç‡è¿‡é«˜æ—¶å‘Šè­¦ï¼‰
- [ ] å®šæœŸå®¡æŸ¥æ‹¦æˆªæ—¥å¿—
- [ ] å‡†å¤‡IPé»‘åå•åŠŸèƒ½
- [ ] å‡†å¤‡éªŒè¯ç åå¤‡æ–¹æ¡ˆ

### ç›‘æ§å‘Šè­¦
- [ ] è®¾ç½®æ—¥å¿—ç›‘æ§
- [ ] ç»Ÿè®¡æ‹¦æˆªç‡
- [ ] ç›‘æ§å¼‚å¸¸IP
- [ ] æ€§èƒ½ç›‘æ§ï¼ˆå“åº”æ—¶é—´ï¼‰

## ğŸ“ éƒ¨ç½²åä»»åŠ¡

### ç¬¬ä¸€å¤©
- [ ] ç›‘æ§æ—¥å¿—ï¼Œç¡®è®¤æ‹¦æˆªæ­£å¸¸å·¥ä½œ
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰è¯¯æ‹¦æˆªï¼ˆæ­£å¸¸ç”¨æˆ·è¢«æ‹¦æˆªï¼‰
- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆ

### ç¬¬ä¸€å‘¨
- [ ] ç»Ÿè®¡æ‹¦æˆªæ•°æ®
- [ ] ä¼˜åŒ–æ‹¦æˆªè§„åˆ™ï¼ˆå¦‚æœæœ‰è¯¯æ‹¦æˆªï¼‰
- [ ] è¯„ä¼°æ€§èƒ½å½±å“

### å®šæœŸç»´æŠ¤
- [ ] æ¯å‘¨æŸ¥çœ‹æ‹¦æˆªæ—¥å¿—
- [ ] æ¯æœˆç»Ÿè®¡æ‹¦æˆªæ•°æ®
- [ ] æ¯å­£åº¦è½®æ¢å¯†é’¥
- [ ] æ¯å¹´å®¡æŸ¥å’Œæ›´æ–°é˜²æŠ¤ç­–ç•¥

## ğŸ†˜ åº”æ€¥å“åº”

### å¦‚æœå‡ºç°å¤§é‡è¯¯æ‹¦æˆª
```bash
# 1. ç«‹å³ç¦ç”¨ç›¸å…³ä¸­é—´ä»¶
docker-compose exec backend vi /app/backend/backend/middleware/SignatureMiddleware.py
# ä¿®æ”¹ ENABLE_SIGNATURE_CHECK = False

# 2. é‡å¯æœåŠ¡
docker-compose restart backend

# 3. åˆ†ææ—¥å¿—æ‰¾å‡ºåŸå› 
docker-compose logs backend | grep "403\|429" > blocked_requests.log

# 4. ä¿®å¤é—®é¢˜åé‡æ–°å¯ç”¨
```

### å¦‚æœå—åˆ°DDoSæ”»å‡»
```bash
# 1. é™ä½é¢‘ç‡é™åˆ¶é˜ˆå€¼
# ç¼–è¾‘ backend/utils/crypto_utils.py
# rate_limiter = RateLimiter(max_requests=10, time_window=60)

# 2. å¯ç”¨æ›´ä¸¥æ ¼çš„æ£€æµ‹
# ç¼–è¾‘ backend/backend/middleware/AntiCrawlerMiddleware.py
# DETECTION_MODE = 'strict'

# 3. è€ƒè™‘ä½¿ç”¨CDNæˆ–DDoSé˜²æŠ¤æœåŠ¡
```

## ğŸ“ æ”¯æŒèµ„æº

- **å®Œæ•´æ–‡æ¡£**: `é˜²çˆ¬å–å’ŒåŠ å¯†æ–¹æ¡ˆè¯´æ˜.md`
- **å¿«é€Ÿé…ç½®**: `é˜²çˆ¬å–å¿«é€Ÿé…ç½®æŒ‡å—.md`
- **ä»£ç ä»“åº“**: æ‰€æœ‰ç›¸å…³ä»£ç å·²æäº¤

## âœ… æœ€ç»ˆç¡®è®¤

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] âœ… æ—¥å¿—æ˜¾ç¤ºæ‹¦æˆªæ­£å¸¸å·¥ä½œ
- [ ] âœ… æ€§èƒ½å½±å“åœ¨å¯æ¥å—èŒƒå›´å†…ï¼ˆ<10msï¼‰
- [ ] âœ… æ²¡æœ‰è¯¯æ‹¦æˆªæ­£å¸¸ç”¨æˆ·
- [ ] âœ… ç›‘æ§ç³»ç»Ÿå·²é…ç½®
- [ ] âœ… åº”æ€¥å“åº”æµç¨‹å·²å‡†å¤‡
- [ ] âœ… å›¢é˜Ÿæˆå‘˜äº†è§£æ–°åŠŸèƒ½

**æ­å–œï¼é˜²çˆ¬å–åŠŸèƒ½å·²æˆåŠŸéƒ¨ç½²ï¼** ğŸ‰

---

*æœ€åæ›´æ–°: 2024-10-15*

