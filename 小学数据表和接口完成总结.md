# å°å­¦æ•°æ®è¡¨å’Œæ¥å£å®Œæˆæ€»ç»“

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

æ ¹æ® `common/data/2025å¹´å°å­¦æ¦‚è§ˆ-ä¼°ç®—å°å…­å­¦ç”Ÿäººæ•°.xlsx` è®¾è®¡æ–°çš„å°å­¦æ•°æ®åº“è¡¨ `tb_primary_schools`ï¼Œåˆ›å»ºå¯¹åº”çš„ ORM æ¨¡å‹ï¼Œå¹¶æ”¹é€ æ¥å£ä½¿å°å­¦é¡µç­¾çš„æ•°æ®ä»æ–°è¡¨è·å–ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾è®¡

**æ–‡ä»¶**: `backend/common/db/tb_primary_schools.sql`

**è®¾è®¡äº®ç‚¹**:
- ä½¿ç”¨ JSON å­—æ®µç®€åŒ–è¡¨ç»“æ„ï¼ˆç›¸æ¯” 110+ ä¸ªå­—æ®µä¼˜åŒ–ä¸º 13 ä¸ªæ ¸å¿ƒå­—æ®µ + 5 ä¸ª JSON å­—æ®µï¼‰
- ä¿ç•™æ ¸å¿ƒæ£€ç´¢å­—æ®µï¼ˆå­¦æ ¡åç§°ã€åŒºåŸŸã€æ ¡ç½‘ã€ç±»åˆ«ç­‰ï¼‰ä½œä¸ºç‹¬ç«‹åˆ—
- å°†ç›¸å…³ä¿¡æ¯åˆ†ç»„åˆ° JSON å­—æ®µä¸­ï¼š
  - `school_basic_info` - å­¦æ ¡åŸºç¡€ä¿¡æ¯
  - `secondary_info` - ä¸­å­¦è”ç³»ä¿¡æ¯
  - `total_classes_info` - ç­çº§ç»“æ„ä¿¡æ¯
  - `class_teaching_info` - æ•™å­¦æ¨¡å¼ä¿¡æ¯
  - `assessment_info` - è¯„ä¼°æ”¿ç­–ä¿¡æ¯

**ç´¢å¼•ä¼˜åŒ–**:
- 7 ä¸ªç´¢å¼•è¦†ç›–å¸¸ç”¨æŸ¥è¯¢å­—æ®µ
- æ”¯æŒé«˜æ•ˆçš„ç­›é€‰å’Œæœç´¢

### 2. ORM æ¨¡å‹

**æ–‡ä»¶**: `backend/backend/models/tb_primary_schools.py`

**åŠŸèƒ½ç‰¹æ€§**:
- å®Œæ•´çš„å­—æ®µå®šä¹‰å’Œç±»å‹å£°æ˜
- JSON å­—æ®µæ”¯æŒ
- å®ç”¨æ–¹æ³•ï¼š
  - `get_full_info()` - è·å–å®Œæ•´ä¿¡æ¯
  - `get_total_classes()` - è·å–æ€»ç­æ•°
  - `get_linked_secondary_schools()` - è·å–å…³è”ä¸­å­¦
  - `is_full_day()` - åˆ¤æ–­æ˜¯å¦å…¨æ—¥åˆ¶
  - `is_coed()` - åˆ¤æ–­æ˜¯å¦ç”·å¥³æ ¡

### 3. API è§†å›¾

**æ–‡ä»¶**: `backend/backend/api/schools/primary_views.py`

**æ¥å£åˆ—è¡¨**:
1. **GET /api/schools/primary/** - è·å–å°å­¦åˆ—è¡¨
   - æ”¯æŒå¤šç»´åº¦ç­›é€‰ï¼ˆç±»åˆ«ã€åŒºåŸŸã€æ ¡ç½‘ã€æ€§åˆ«ã€å®—æ•™ã€æ•™å­¦è¯­è¨€ï¼‰
   - æ”¯æŒå…³é”®è¯æœç´¢ï¼ˆæ™ºèƒ½æ’åºï¼‰
   - æ”¯æŒåˆ†é¡µ

2. **GET /api/schools/primary/{id}/** - è·å–å°å­¦è¯¦æƒ…
   - è¿”å›å®Œæ•´çš„å­¦æ ¡ä¿¡æ¯
   - åŒ…å« JSON å­—æ®µæ•°æ®

3. **GET /api/schools/primary/stats/** - è·å–ç»Ÿè®¡ä¿¡æ¯
   - æŒ‰ç±»åˆ«ã€åŒºåŸŸã€æ€§åˆ«ã€å®—æ•™ã€æ ¡ç½‘ç»Ÿè®¡

4. **GET /api/schools/primary/filters/** - è·å–ç­›é€‰é€‰é¡¹
   - è¿”å›æ‰€æœ‰å¯ç”¨çš„ç­›é€‰å€¼

**åºåˆ—åŒ–ç‰¹æ€§**:
- æ™ºèƒ½è§£æ JSON å­—æ®µ
- è‡ªåŠ¨æå–å…³è”ä¸­å­¦ä¿¡æ¯
- æ ¼å¼åŒ–è¾“å‡ºï¼Œä¾¿äºå‰ç«¯ä½¿ç”¨

### 4. URL è·¯ç”±

**æ–‡ä»¶**: `backend/backend/api/schools/urls.py`

**æ›´æ–°å†…å®¹**:
- å¼•å…¥ `primary_views` æ¨¡å—
- é…ç½®å°å­¦æ¥å£è·¯ç”±
- æ·»åŠ ç»Ÿè®¡å’Œç­›é€‰æ¥å£

### 5. æ•°æ®å¯¼å…¥è„šæœ¬

**æ–‡ä»¶**: `backend/common/data/import_primary_schools.py`

**åŠŸèƒ½ç‰¹æ€§**:
- ä» Excel è¯»å–å°å­¦æ•°æ®
- æ™ºèƒ½æ•°æ®æ¸…ç†å’Œè½¬æ¢
- è‡ªåŠ¨æ„å»º JSON å¯¹è±¡
- æ”¯æŒåˆ›å»ºå’Œæ›´æ–°
- è¯¦ç»†çš„å¯¼å…¥æ—¥å¿—

**æ•°æ®å¤„ç†**:
- ç”µè¯å·ç æ ¼å¼åŒ–
- æ—¶é—´å­—æ®µè½¬æ¢
- ç©ºå€¼è¿‡æ»¤
- JSON å¯¹è±¡æ„å»º

### 6. æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `backend/common/data/test_primary_schools_orm.py`

**æµ‹è¯•è¦†ç›–**:
- CRUD æ“ä½œï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- æ¨¡å‹æ–¹æ³•æµ‹è¯•
- è¿‡æ»¤æŸ¥è¯¢æµ‹è¯•
- JSON å­—æ®µæ“ä½œæµ‹è¯•

### 7. æ–‡æ¡£

**æ–‡ä»¶**: `backend/common/data/import_primary_schools_README.md`

**å†…å®¹åŒ…æ‹¬**:
- è¡¨ç»“æ„è¯´æ˜
- ä½¿ç”¨æ­¥éª¤
- API æ¥å£æ–‡æ¡£
- æ•°æ®éªŒè¯æ–¹æ³•
- æ•…éšœæ’é™¤æŒ‡å—

## ğŸ“Š æ•°æ®ç»“æ„å¯¹æ¯”

| é¡¹ç›® | åŸ tb_schools | tb_primary_schools | tb_secondary_schools |
|-----|--------------|-------------------|---------------------|
| è¡¨å­—æ®µæ•° | ~20 | 18 (å«5ä¸ªJSON) | ~20 |
| æ˜¯å¦ä¸“ç”¨ | âŒ é€šç”¨ | âœ… å°å­¦ä¸“ç”¨ | âœ… ä¸­å­¦ä¸“ç”¨ |
| JSON å­—æ®µ | 1 ä¸ª | 5 ä¸ª | 0 ä¸ª |
| ä¸­å­¦è”ç³» | âŒ | âœ… | âŒ |
| ç­çº§ç»“æ„ | âŒ | âœ… | âœ… |
| è¯„ä¼°æ”¿ç­– | âŒ | âœ… | âŒ |

## ğŸ”„ æ¥å£æ”¹é€ è¯´æ˜

### æ”¹é€ å‰
```python
# ä» tb_schools è¡¨è¯»å–å°å­¦æ•°æ®
GET /api/schools/primary/
-> TbSchools.objects.filter(level='primary')
```

### æ”¹é€ å
```python
# ä» tb_primary_schools è¡¨è¯»å–å°å­¦æ•°æ®
GET /api/schools/primary/
-> TbPrimarySchools.objects.all()
```

### æ–°å¢æ¥å£
```python
GET /api/schools/primary/stats/      # ç»Ÿè®¡ä¿¡æ¯
GET /api/schools/primary/filters/    # ç­›é€‰é€‰é¡¹
GET /api/schools/primary/{id}/       # å­¦æ ¡è¯¦æƒ…
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. åˆ›å»ºæ•°æ®åº“è¡¨
```bash
cd /data/home/roylei/Educational-Counselor-Assistant/backend
mysql -u root -p dev_yundisoft < common/db/tb_primary_schools.sql
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœä½¿ç”¨ Django migrationsï¼‰
```bash
python3 manage.py makemigrations
python3 manage.py migrate
```

### 3. å¯¼å…¥å°å­¦æ•°æ®
```bash
python3 common/data/import_primary_schools.py
```

### 4. æµ‹è¯• ORM æ¨¡å‹
```bash
python3 common/data/test_primary_schools_orm.py
```

### 5. é‡å¯åç«¯æœåŠ¡
```bash
# å¦‚æœä½¿ç”¨ Docker
docker-compose restart backend

# å¦‚æœç›´æ¥è¿è¡Œ
supervisorctl restart backend
```

### 6. éªŒè¯æ¥å£
```bash
# æµ‹è¯•å°å­¦åˆ—è¡¨æ¥å£
curl http://localhost:8080/api/schools/primary/

# æµ‹è¯•ç»Ÿè®¡æ¥å£
curl http://localhost:8080/api/schools/primary/stats/

# æµ‹è¯•ç­›é€‰é€‰é¡¹æ¥å£
curl http://localhost:8080/api/schools/primary/filters/
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### Python æŸ¥è¯¢ç¤ºä¾‹
```python
from backend.models.tb_primary_schools import TbPrimarySchools

# æŸ¥è¯¢æ‰€æœ‰å°å­¦
schools = TbPrimarySchools.objects.all()

# æŒ‰åŒºåŸŸæŸ¥è¯¢
cwq_schools = TbPrimarySchools.objects.filter(district='ä¸­è¥¿åŒº')

# æŒ‰å…³é”®è¯æœç´¢
results = TbPrimarySchools.objects.filter(school_name__icontains='åœ£')

# è·å–æœ‰ç›´å±ä¸­å­¦çš„å°å­¦
with_direct = TbPrimarySchools.objects.filter(
    secondary_info__has_key='direct'
)

# è·å–å­¦æ ¡è¯¦ç»†ä¿¡æ¯
school = TbPrimarySchools.objects.first()
info = school.get_full_info()
linked_schools = school.get_linked_secondary_schools()
```

### API è°ƒç”¨ç¤ºä¾‹
```bash
# è·å–ä¸­è¥¿åŒºçš„èµ„åŠ©å°å­¦
curl "http://localhost:8080/api/schools/primary/?district=ä¸­è¥¿åŒº&category=èµ„åŠ©"

# æœç´¢å…³é”®è¯
curl "http://localhost:8080/api/schools/primary/?keyword=åœ£"

# è·å–å­¦æ ¡è¯¦æƒ…
curl "http://localhost:8080/api/schools/primary/1/"

# è·å–ç»Ÿè®¡ä¿¡æ¯
curl "http://localhost:8080/api/schools/primary/stats/"
```

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

1. **JSON å­—æ®µä¼˜åŒ–** - å‡å°‘è¡¨å­—æ®µæ•°é‡ï¼Œæé«˜å¯ç»´æŠ¤æ€§
2. **æ™ºèƒ½æœç´¢** - æ”¯æŒå¤šå­—æ®µæœç´¢ï¼Œæ™ºèƒ½æ’åº
3. **æ•°æ®éªŒè¯** - è‡ªåŠ¨æ¸…ç†å’Œè½¬æ¢æ•°æ®
4. **å®Œæ•´æ–‡æ¡£** - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹
5. **æµ‹è¯•è¦†ç›–** - å®Œæ•´çš„å•å…ƒæµ‹è¯•
6. **å‘åå…¼å®¹** - ä¿ç•™åŸæœ‰æ¥å£ï¼Œæ¸è¿›å¼è¿ç§»

## ğŸ“‚ ç›¸å…³æ–‡ä»¶æ¸…å•

### æ•°æ®åº“
- `backend/common/db/tb_primary_schools.sql` - è¡¨ç»“æ„å®šä¹‰

### æ¨¡å‹
- `backend/backend/models/tb_primary_schools.py` - ORM æ¨¡å‹

### è§†å›¾
- `backend/backend/api/schools/primary_views.py` - API è§†å›¾
- `backend/backend/api/schools/urls.py` - URL è·¯ç”±

### æ•°æ®å¯¼å…¥
- `backend/common/data/import_primary_schools.py` - å¯¼å…¥è„šæœ¬
- `backend/common/data/import_primary_schools_README.md` - å¯¼å…¥è¯´æ˜

### æµ‹è¯•
- `backend/common/data/test_primary_schools_orm.py` - ORM æµ‹è¯•

### æ•°æ®æº
- `backend/common/data/2025å¹´å°å­¦æ¦‚è§ˆ-ä¼°ç®—å°å…­å­¦ç”Ÿäººæ•°.xlsx` - Excel æ•°æ®

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“å¤‡ä»½** - å¯¼å…¥å‰è¯·å¤‡ä»½æ•°æ®åº“
2. **ä¾èµ–æ£€æŸ¥** - ç¡®ä¿å®‰è£…äº† `openpyxl` åº“ï¼ˆ`pip install openpyxl`ï¼‰
3. **ç¯å¢ƒå˜é‡** - ç¡®ä¿ `DJANGO_SETTINGS_MODULE` è®¾ç½®æ­£ç¡®
4. **æƒé™é—®é¢˜** - ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰åˆ›å»ºè¡¨çš„æƒé™
5. **JSON å­—æ®µ** - MySQL 5.7.8+ æ‰æ”¯æŒ JSON ç±»å‹

## ğŸ” åç»­ä¼˜åŒ–å»ºè®®

1. **å…¨æ–‡æœç´¢** - è€ƒè™‘æ·»åŠ  MySQL å…¨æ–‡ç´¢å¼•æˆ– Elasticsearch
2. **ç¼“å­˜ä¼˜åŒ–** - ä¸ºç»Ÿè®¡æ¥å£æ·»åŠ  Redis ç¼“å­˜
3. **æ€§èƒ½ç›‘æ§** - æ·»åŠ æ…¢æŸ¥è¯¢æ—¥å¿—å’Œæ€§èƒ½ç›‘æ§
4. **æ•°æ®æ›´æ–°** - å»ºç«‹å®šæœŸæ•°æ®æ›´æ–°æœºåˆ¶
5. **æ•°æ®å¯¼å‡º** - æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- README æ–‡æ¡£ï¼š`backend/common/data/import_primary_schools_README.md`
- æµ‹è¯•è„šæœ¬ï¼š`backend/common/data/test_primary_schools_orm.py`
- ä»£ç æ³¨é‡Šï¼šæŸ¥çœ‹å„æ–‡ä»¶ä¸­çš„è¯¦ç»†æ³¨é‡Š

---

**å®Œæˆæ—¶é—´**: 2025-10-19  
**å®ŒæˆçŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•

