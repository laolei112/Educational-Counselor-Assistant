# é˜²çˆ¬å–å’Œæ•°æ®åŠ å¯†æ–¹æ¡ˆè¯´æ˜Ž

## ðŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

æœ¬æ–¹æ¡ˆå®žçŽ°äº†å¤šå±‚æ¬¡çš„é˜²çˆ¬å–å’Œæ•°æ®ä¿æŠ¤æœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼š

1. **è¯·æ±‚ç­¾åéªŒè¯** - ç¡®ä¿è¯·æ±‚æ¥è‡ªå¯ä¿¡å®¢æˆ·ç«¯
2. **æ—¶é—´æˆ³éªŒè¯** - é˜²æ­¢é‡æ”¾æ”»å‡»
3. **é¢‘çŽ‡é™åˆ¶** - é™åˆ¶è¯·æ±‚é¢‘çŽ‡ï¼Œé˜²æ­¢æš´åŠ›çˆ¬å–
4. **åçˆ¬è™«æ£€æµ‹** - è¯†åˆ«å¸¸è§çˆ¬è™«å·¥å…·
5. **è®¾å¤‡æŒ‡çº¹** - è¿½è¸ªå’Œè¯†åˆ«å®¢æˆ·ç«¯
6. **HTTPSåŠ å¯†** - ä¼ è¾“å±‚åŠ å¯†

## ðŸ—ï¸ æž¶æž„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚
â”‚ (æµè§ˆå™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. ç”Ÿæˆç­¾å (timestamp + nonce + params + secret)
       â”‚ 2. æ·»åŠ è¯·æ±‚å¤´ (X-Api-Key, X-Timestamp, X-Nonce, X-Signature)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTPS      â”‚ â† SSL/TLSåŠ å¯†ä¼ è¾“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Nginx (åå‘ä»£ç†)                â”‚
â”‚  - HTTPSç»ˆæ­¢                            â”‚
â”‚  - è¯ä¹¦ç®¡ç†                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Djangoä¸­é—´ä»¶ï¼ˆå¤šå±‚é˜²æŠ¤ï¼‰              â”‚
â”‚                                         â”‚
â”‚  1. RateLimitMiddleware                 â”‚
â”‚     â””â”€ æ£€æŸ¥è¯·æ±‚é¢‘çŽ‡                      â”‚
â”‚     â””â”€ IP/è®¾å¤‡æŒ‡çº¹é™åˆ¶                   â”‚
â”‚                                         â”‚
â”‚  2. AntiCrawlerMiddleware               â”‚
â”‚     â””â”€ User-Agentæ£€æµ‹                   â”‚
â”‚     â””â”€ è¡Œä¸ºæ¨¡å¼è¯†åˆ«                      â”‚
â”‚                                         â”‚
â”‚  3. SignatureMiddleware                 â”‚
â”‚     â””â”€ éªŒè¯APIç­¾å                       â”‚
â”‚     â””â”€ æ—¶é—´æˆ³éªŒè¯                        â”‚
â”‚     â””â”€ Nonceé˜²é‡æ”¾                      â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (é€šè¿‡æ‰€æœ‰éªŒè¯)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API View   â”‚
â”‚  å¤„ç†ä¸šåŠ¡é€»è¾‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ” æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. è¯·æ±‚ç­¾åæœºåˆ¶

#### ç­¾åç®—æ³•
```
signature = SHA256(timestamp + nonce + apiKey + sortedParams + requestBody + apiSecret)
```

#### å‰ç«¯å®žçŽ°
- æ–‡ä»¶ä½ç½®ï¼š`frontend/src/utils/crypto.ts`
- æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨ç”Ÿæˆç­¾å
- æ·»åŠ ç­¾åç›¸å…³è¯·æ±‚å¤´

#### åŽç«¯éªŒè¯
- æ–‡ä»¶ä½ç½®ï¼š`backend/backend/middleware/SignatureMiddleware.py`
- éªŒè¯ç­¾åå®Œæ•´æ€§
- æ£€æŸ¥æ—¶é—´æˆ³æœ‰æ•ˆæ€§ï¼ˆé»˜è®¤5åˆ†é’Ÿçª—å£ï¼‰
- é˜²æ­¢nonceé‡å¤ï¼ˆé˜²é‡æ”¾æ”»å‡»ï¼‰

#### å…³é”®è¯·æ±‚å¤´
```http
X-Api-Key: web-client-v1          # å®¢æˆ·ç«¯æ ‡è¯†
X-Timestamp: 1697366400           # è¯·æ±‚æ—¶é—´æˆ³
X-Nonce: AbC123XyZ...             # éšæœºå­—ç¬¦ä¸²
X-Signature: sha256hash...        # è¯·æ±‚ç­¾å
X-Device-Id: base64deviceinfo     # è®¾å¤‡æŒ‡çº¹
```

### 2. é¢‘çŽ‡é™åˆ¶

#### é…ç½®å‚æ•°
- **é»˜è®¤é™åˆ¶**ï¼š100æ¬¡è¯·æ±‚/60ç§’
- **å°ç¦æ—¶é•¿**ï¼šè¶…é™åŽå°ç¦120ç§’
- **è¯†åˆ«æ–¹å¼**ï¼šè®¾å¤‡ID > IPåœ°å€

#### å“åº”å¤´
```http
X-RateLimit-Limit: 100            # æ€»é™é¢
X-RateLimit-Remaining: 45         # å‰©ä½™æ¬¡æ•°
X-RateLimit-Reset: 60             # é‡ç½®æ—¶é—´ï¼ˆç§’ï¼‰
Retry-After: 120                  # è¢«é™åˆ¶æ—¶çš„é‡è¯•æ—¶é—´
```

#### è‡ªå®šä¹‰é…ç½®
ä¿®æ”¹ `backend/utils/crypto_utils.py`:
```python
rate_limiter = RateLimiter(
    max_requests=200,    # å¢žåŠ é™é¢åˆ°200
    time_window=60       # æ—¶é—´çª—å£60ç§’
)
```

### 3. åçˆ¬è™«æ£€æµ‹

#### æ£€æµ‹è§„åˆ™

1. **User-Agenté»‘åå•**
   - bot, crawl, spider, scrapy
   - python-requests, curl, wget
   - headless, selenium, puppeteer
   - ç­‰å¸¸è§çˆ¬è™«å·¥å…·

2. **è¡Œä¸ºæ£€æµ‹ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰**
   - ç¼ºå°‘User-Agent
   - User-Agentè¿‡äºŽç®€å•
   - ç¼ºå°‘Acceptè¯·æ±‚å¤´
   - ç¼ºå°‘Accept-Language

3. **ç™½åå•**
   - å…è®¸æœç´¢å¼•æ“Žçˆ¬è™«ï¼ˆGooglebot, Bingbotç­‰ï¼‰

#### æ£€æµ‹æ¨¡å¼
ä¿®æ”¹ `backend/backend/middleware/AntiCrawlerMiddleware.py`:
```python
DETECTION_MODE = 'moderate'  # æˆ– 'strict'
```

### 4. è®¾å¤‡æŒ‡çº¹

#### ç”Ÿæˆæ–¹å¼
åŸºäºŽä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼š
- User-Agent
- è¯­è¨€è®¾ç½®
- æ—¶åŒºåç§»
- å±å¹•åˆ†è¾¨çŽ‡
- é¢œè‰²æ·±åº¦

#### ç”¨é€”
- è·¨ä¼šè¯è¿½è¸ªç”¨æˆ·
- é…åˆé¢‘çŽ‡é™åˆ¶
- å¼‚å¸¸è¡Œä¸ºæ£€æµ‹

## âš™ï¸ é…ç½®æŒ‡å—

### å‰ç«¯é…ç½®

#### 1. åˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶
åˆ›å»º `frontend/.env` æ–‡ä»¶ï¼š
```bash
# APIå¯†é’¥ï¼ˆå¿…é¡»ä¸ŽåŽç«¯ä¸€è‡´ï¼‰
VITE_API_SECRET=your-secret-key-change-in-production
VITE_API_KEY=web-client-v1
```

#### 2. å¯†é’¥ç®¡ç†
- **å¼€å‘çŽ¯å¢ƒ**ï¼šå¯ä»¥ä½¿ç”¨é»˜è®¤å¯†é’¥
- **ç”Ÿäº§çŽ¯å¢ƒ**ï¼šå¿…é¡»ä¿®æ”¹ä¸ºå¼ºå¯†é’¥

ç”Ÿæˆå¼ºå¯†é’¥ç¤ºä¾‹ï¼š
```bash
# Linux/Mac
openssl rand -base64 32

# æˆ–ä½¿ç”¨Python
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

### åŽç«¯é…ç½®

#### 1. è®¾ç½®çŽ¯å¢ƒå˜é‡
åœ¨ `docker-compose.yml` æˆ–ç³»ç»ŸçŽ¯å¢ƒä¸­è®¾ç½®ï¼š
```yaml
environment:
  - API_SECRET=your-secret-key-change-in-production
```

æˆ–ç›´æŽ¥ä¿®æ”¹ `backend/utils/crypto_utils.py`ï¼š
```python
def __init__(self, secret_key: str = None, valid_api_keys: list = None):
    self.secret_key = secret_key or 'your-custom-secret-key'
    self.valid_api_keys = valid_api_keys or ['web-client-v1']
```

#### 2. è°ƒæ•´ä¸­é—´ä»¶å¼€å…³
åœ¨å„ä¸­é—´ä»¶æ–‡ä»¶ä¸­å¯ä»¥ä¸´æ—¶ç¦ç”¨ï¼š

**SignatureMiddleware.py:**
```python
ENABLE_SIGNATURE_CHECK = False  # ç¦ç”¨ç­¾åéªŒè¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
```

**RateLimitMiddleware.py:**
```python
ENABLE_RATE_LIMIT = False  # ç¦ç”¨é¢‘çŽ‡é™åˆ¶ï¼ˆè°ƒè¯•ç”¨ï¼‰
```

**AntiCrawlerMiddleware.py:**
```python
ENABLE_ANTI_CRAWLER = False  # ç¦ç”¨åçˆ¬è™«æ£€æµ‹ï¼ˆè°ƒè¯•ç”¨ï¼‰
```

#### 3. ç™½åå•é…ç½®
å¦‚æžœæœ‰ç‰¹å®šè·¯å¾„ä¸éœ€è¦ä¿æŠ¤ï¼Œæ·»åŠ åˆ°ç™½åå•ï¼š

```python
# åœ¨å„ä¸­é—´ä»¶ä¸­ä¿®æ”¹
WHITELIST_PATHS = [
    '/api/health',
    '/nginx-health',
    '/swagger/',
    '/admin/',
    '/api/public/',  # æ·»åŠ å…¬å¼€è·¯å¾„
]
```

#### 4. é¢‘çŽ‡é™åˆ¶è°ƒæ•´
ç”Ÿäº§çŽ¯å¢ƒå»ºè®®ä½¿ç”¨Rediså­˜å‚¨ï¼š

å®‰è£…ä¾èµ–ï¼š
```bash
pip install redis
```

ä¿®æ”¹ `backend/utils/crypto_utils.py`ï¼Œä½¿ç”¨Rediså­˜å‚¨ï¼š
```python
import redis

class RateLimiter:
    def __init__(self):
        self.redis_client = redis.Redis(
            host='localhost',
            port=6379,
            db=0,
            decode_responses=True
        )
```

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### 1. å‰ç«¯éƒ¨ç½²

```bash
cd frontend

# 1. è®¾ç½®çŽ¯å¢ƒå˜é‡
cat > .env << EOF
VITE_API_SECRET=your-production-secret-key-here
VITE_API_KEY=web-client-v1
EOF

# 2. å®‰è£…ä¾èµ–
npm install

# 3. æž„å»º
npm run build

# 4. æž„å»ºDockeré•œåƒ
docker build -t edu-frontend .
```

### 2. åŽç«¯éƒ¨ç½²

```bash
cd backend

# 1. è®¾ç½®çŽ¯å¢ƒå˜é‡
export API_SECRET="your-production-secret-key-here"

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. æž„å»ºDockeré•œåƒ
docker build -t edu-backend .
```

### 3. ä½¿ç”¨Docker Composeéƒ¨ç½²

```bash
# 1. æ›´æ–°docker-compose.ymlï¼Œæ·»åŠ çŽ¯å¢ƒå˜é‡
# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend
```

## ðŸ§ª æµ‹è¯•éªŒè¯

### 1. æµ‹è¯•æ­£å¸¸è¯·æ±‚

```bash
# ä½¿ç”¨æµè§ˆå™¨è®¿é—®åº”è¯¥æ­£å¸¸å·¥ä½œ
curl -X GET https://yourdomain.com/api/schools/primary \
  -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

### 2. æµ‹è¯•ç­¾åéªŒè¯

```bash
# æ— ç­¾åè¯·æ±‚åº”è¯¥è¢«æ‹’ç»ï¼ˆ403ï¼‰
curl -X GET https://yourdomain.com/api/schools/primary

# å“åº”ï¼š
# {"code": 403, "message": "ç­¾åéªŒè¯å¤±è´¥: ç¼ºå°‘å¿…è¦çš„ç­¾åå‚æ•°", "success": false}
```

### 3. æµ‹è¯•é¢‘çŽ‡é™åˆ¶

```bash
# å¿«é€Ÿå‘é€100+è¯·æ±‚
for i in {1..110}; do
  curl https://yourdomain.com/api/schools/primary
done

# ç¬¬101ä¸ªè¯·æ±‚åº”è¿”å›ž429
# {"code": 429, "message": "è¯·æ±‚è¿‡äºŽé¢‘ç¹...", "success": false}
```

### 4. æµ‹è¯•åçˆ¬è™«

```bash
# ä½¿ç”¨çˆ¬è™«User-Agentåº”è¯¥è¢«æ‹’ç»
curl -X GET https://yourdomain.com/api/schools/primary \
  -H "User-Agent: python-requests/2.28.0"

# å“åº”ï¼š
# {"code": 403, "message": "è®¿é—®è¢«æ‹’ç»", "success": false}
```

### 5. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åŽç«¯æ—¥å¿—ä¸­çš„é˜²æŠ¤è®°å½•
tail -f backend/log/backend.log | grep -E "(ç­¾åéªŒè¯|é¢‘çŽ‡é™åˆ¶|æ£€æµ‹åˆ°çˆ¬è™«)"
```

## ðŸ“Š ç›‘æŽ§å’Œåˆ†æž

### æ—¥å¿—ç¤ºä¾‹

```
INFO 2024-10-15 10:30:15 ç­¾åéªŒè¯å¤±è´¥: æ— æ•ˆçš„API Key, Path: /api/schools, IP: 192.168.1.100
INFO 2024-10-15 10:30:20 é¢‘çŽ‡é™åˆ¶è§¦å‘: è¯·æ±‚è¿‡äºŽé¢‘ç¹, Client: ip:192.168.1.101, Path: /api/schools
INFO 2024-10-15 10:30:25 æ£€æµ‹åˆ°çˆ¬è™«è®¿é—®: åŒ¹é…çˆ¬è™«ç‰¹å¾: scrapy, IP: 192.168.1.102, User-Agent: scrapy/2.8.0
```

### åˆ†æžè¢«æ‹¦æˆªçš„è¯·æ±‚

```bash
# ç»Ÿè®¡è¢«æ‹¦æˆªçš„IP
grep "ç­¾åéªŒè¯å¤±è´¥\|é¢‘çŽ‡é™åˆ¶\|çˆ¬è™«" backend/log/backend.log | \
  grep -oP "IP: \K[0-9.]+" | sort | uniq -c | sort -rn

# ç»Ÿè®¡çˆ¬è™«ç±»åž‹
grep "æ£€æµ‹åˆ°çˆ¬è™«" backend/log/backend.log | \
  grep -oP "User-Agent: \K[^,]+" | sort | uniq -c | sort -rn
```

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### é—®é¢˜1ï¼šå‰ç«¯è¯·æ±‚å…¨éƒ¨å¤±è´¥ï¼ˆ403ï¼‰

**åŽŸå› **ï¼šå‰åŽç«¯å¯†é’¥ä¸ä¸€è‡´

**è§£å†³**ï¼š
1. æ£€æŸ¥å‰ç«¯ `.env` æ–‡ä»¶ä¸­çš„ `VITE_API_SECRET`
2. æ£€æŸ¥åŽç«¯çŽ¯å¢ƒå˜é‡ `API_SECRET`
3. ç¡®ä¿ä¸¤è€…å®Œå…¨ä¸€è‡´

### é—®é¢˜2ï¼šæ­£å¸¸ç”¨æˆ·è¢«è¯¯æ‹¦æˆª

**åŽŸå› **ï¼šæ£€æµ‹è§„åˆ™è¿‡äºŽä¸¥æ ¼

**è§£å†³**ï¼š
1. ä¿®æ”¹ `AntiCrawlerMiddleware.py`
   ```python
   DETECTION_MODE = 'moderate'  # ä»Žstrictæ”¹ä¸ºmoderate
   ```
2. æˆ–ä¸´æ—¶ç¦ç”¨åçˆ¬è™«æ£€æµ‹
   ```python
   ENABLE_ANTI_CRAWLER = False
   ```

### é—®é¢˜3ï¼šå¼€å‘æ—¶é¢‘ç¹è§¦å‘é¢‘çŽ‡é™åˆ¶

**åŽŸå› **ï¼šå¼€å‘æ—¶è¯·æ±‚é¢‘çŽ‡é«˜

**è§£å†³**ï¼š
1. ä¸´æ—¶ç¦ç”¨é¢‘çŽ‡é™åˆ¶
   ```python
   ENABLE_RATE_LIMIT = False
   ```
2. æˆ–å¢žåŠ é™é¢
   ```python
   rate_limiter = RateLimiter(max_requests=1000, time_window=60)
   ```

### é—®é¢˜4ï¼šæ—¶é—´æˆ³éªŒè¯å¤±è´¥

**åŽŸå› **ï¼šæœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥

**è§£å†³**ï¼š
```bash
# åŒæ­¥æœåŠ¡å™¨æ—¶é—´
ntpdate -u pool.ntp.org

# æˆ–å®‰è£…NTPæœåŠ¡
apt-get install ntp
systemctl start ntp
```

## ðŸ”’ å®‰å…¨å»ºè®®

### 1. å¯†é’¥ç®¡ç†

- âœ… **å¿…é¡»**ï¼šç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨å¼ºéšæœºå¯†é’¥
- âœ… **å¿…é¡»**ï¼šé€šè¿‡çŽ¯å¢ƒå˜é‡ä¼ é€’å¯†é’¥ï¼Œä¸è¦ç¡¬ç¼–ç 
- âœ… **å¿…é¡»**ï¼šå®šæœŸè½®æ¢å¯†é’¥
- âœ… **å»ºè®®**ï¼šå‰åŽç«¯å¯†é’¥ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚AWS KMSï¼‰

### 2. HTTPSé…ç½®

- âœ… **å¿…é¡»**ï¼šç”Ÿäº§çŽ¯å¢ƒå¼ºåˆ¶ä½¿ç”¨HTTPS
- âœ… **å¿…é¡»**ï¼šä½¿ç”¨æœ‰æ•ˆçš„SSLè¯ä¹¦ï¼ˆæŽ¨èLet's Encryptï¼‰
- âœ… **å»ºè®®**ï¼šå¯ç”¨HSTSï¼ˆå·²é…ç½®ï¼‰
- âœ… **å»ºè®®**ï¼šä½¿ç”¨TLS 1.2+ï¼ˆå·²é…ç½®ï¼‰

### 3. ç›‘æŽ§å‘Šè­¦

- âœ… **å»ºè®®**ï¼šè®¾ç½®æ—¥å¿—ç›‘æŽ§ï¼ŒåŠæ—¶å‘çŽ°å¼‚å¸¸
- âœ… **å»ºè®®**ï¼šç»Ÿè®¡æ‹¦æˆªçŽ‡ï¼Œè¯„ä¼°é˜²æŠ¤æ•ˆæžœ
- âœ… **å»ºè®®**ï¼šå®šæœŸå®¡æŸ¥ç™½åå•å’Œé»‘åå•

### 4. æ•°æ®ä¿æŠ¤

- âœ… **å»ºè®®**ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- âœ… **å»ºè®®**ï¼šé™åˆ¶å•æ¬¡è¿”å›žçš„æ•°æ®é‡
- âœ… **å»ºè®®**ï¼šå®žçŽ°æ•°æ®è„±æ•

### 5. åº”æ€¥å“åº”

- âœ… **å¿…é¡»**ï¼šå‡†å¤‡å¿«é€Ÿç¦ç”¨å¼€å…³
- âœ… **å»ºè®®**ï¼šå‡†å¤‡IPé»‘åå•åŠŸèƒ½
- âœ… **å»ºè®®**ï¼šå‡†å¤‡éªŒè¯ç åŽå¤‡æ–¹æ¡ˆ

## ðŸ“ˆ æ€§èƒ½å½±å“

### é¢„æœŸå½±å“

| åŠŸèƒ½ | å»¶è¿Ÿå¢žåŠ  | CPUå ç”¨ | å†…å­˜å ç”¨ |
|------|---------|---------|----------|
| ç­¾åéªŒè¯ | ~2-5ms | ä½Ž | ä½Ž |
| é¢‘çŽ‡é™åˆ¶ | ~1ms | ä½Ž | ä¸­ï¼ˆå†…å­˜ç¼“å­˜ï¼‰ |
| åçˆ¬è™«æ£€æµ‹ | ~1ms | ä½Ž | ä½Ž |
| **æ€»è®¡** | **~5-10ms** | **ä½Ž** | **ä¸­** |

### ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨Rediså­˜å‚¨é¢‘çŽ‡é™åˆ¶æ•°æ®**
   - å‡å°‘å†…å­˜å ç”¨
   - æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
   - æ›´å¯é çš„æŒä¹…åŒ–

2. **ç¼“å­˜ç­¾åéªŒè¯ç»“æžœ**
   - çŸ­æ—¶é—´å†…ç›¸åŒè¯·æ±‚ä¸é‡å¤éªŒè¯
   - æƒè¡¡å®‰å…¨æ€§å’Œæ€§èƒ½

3. **å¼‚æ­¥æ—¥å¿—è®°å½•**
   - ä½¿ç”¨å¼‚æ­¥æ—¥å¿—é¿å…é˜»å¡ž
   - å®šæœŸå½’æ¡£åŽ†å²æ—¥å¿—

## ðŸ†˜ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡ä»¶

**å‰ç«¯ï¼š**
- `frontend/src/utils/crypto.ts` - åŠ å¯†å’Œç­¾åå·¥å…·
- `frontend/src/api/request.ts` - HTTPè¯·æ±‚å°è£…

**åŽç«¯ï¼š**
- `backend/utils/crypto_utils.py` - ç­¾åéªŒè¯å’Œé¢‘çŽ‡é™åˆ¶
- `backend/backend/middleware/SignatureMiddleware.py` - ç­¾åéªŒè¯ä¸­é—´ä»¶
- `backend/backend/middleware/RateLimitMiddleware.py` - é¢‘çŽ‡é™åˆ¶ä¸­é—´ä»¶
- `backend/backend/middleware/AntiCrawlerMiddleware.py` - åçˆ¬è™«ä¸­é—´ä»¶
- `backend/backend/basic_settings.py` - ä¸­é—´ä»¶é…ç½®

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹è¯·æ±‚å¤´**
   ```javascript
   // åœ¨æµè§ˆå™¨æŽ§åˆ¶å°
   console.log('Request Headers:', xhr.getAllResponseHeaders());
   ```

2. **æµ‹è¯•ç­¾åç”Ÿæˆ**
   ```python
   # åœ¨Django shellä¸­
   from utils.crypto_utils import signature_validator
   is_valid, msg = signature_validator.validate_signature(
       timestamp='1697366400',
       nonce='test123',
       api_key='web-client-v1',
       signature='...',
       params={'page': '1'}
   )
   print(f"Valid: {is_valid}, Message: {msg}")
   ```

3. **ç›‘æŽ§è¯·æ±‚**
   ```bash
   # å®žæ—¶æŸ¥çœ‹è¢«æ‹¦æˆªçš„è¯·æ±‚
   tail -f backend/log/backend.log | grep -E "(403|429)"
   ```

## ðŸ“ æ›´æ–°è®°å½•

- **2024-10-15**
  - âœ… å®žçŽ°è¯·æ±‚ç­¾åæœºåˆ¶
  - âœ… å®žçŽ°é¢‘çŽ‡é™åˆ¶
  - âœ… å®žçŽ°åçˆ¬è™«æ£€æµ‹
  - âœ… é…ç½®HTTPSæ”¯æŒ
  - âœ… å®Œå–„æ–‡æ¡£

---

## âš ï¸ é‡è¦æç¤º

1. **ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²å‰å¿…é¡»ä¿®æ”¹å¯†é’¥**
2. **å»ºè®®å…ˆåœ¨æµ‹è¯•çŽ¯å¢ƒéªŒè¯æ‰€æœ‰åŠŸèƒ½**
3. **å®šæœŸæ£€æŸ¥æ—¥å¿—ï¼Œä¼˜åŒ–æ‹¦æˆªè§„åˆ™**
4. **ä¿æŒé˜²æŠ¤æœºåˆ¶å’Œä¸šåŠ¡éœ€æ±‚çš„å¹³è¡¡**

