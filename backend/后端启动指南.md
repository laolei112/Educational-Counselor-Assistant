# 🚀 后端API启动指南

## ✅ 问题修复总结

已修复Django版本兼容性问题：
- 将 `django.conf.urls.url` 替换为 `django.urls.re_path`
- 创建完整的学校API接口
- 配置CORS支持前端访问
- 启用DEBUG模式便于开发

## 🛠️ 环境要求

- Python 3.8+
- Django 4.0+（已兼容）
- MySQL数据库
- Redis缓存

## 📋 启动步骤

### 1. 安装依赖
```bash
cd backend
pip install -r requirements.txt
```

### 2. 配置数据库
确保 `config/conf/dev/backend/settings.json` 中的数据库配置正确：
```json
{
  "mysql": {
    "host": "localhost",
    "port": 3306,
    "user": "your_username",
    "password": "your_password",
    "db": "your_database"
  },
  "redis": {
    "host": "localhost",
    "port": 6379,
    "db": 0,
    "password": ""
  }
}
```

### 3. 数据库迁移
```bash
python manage.py makemigrations
python manage.py migrate
```

### 4. 启动服务器
```bash
python manage.py runserver 0.0.0.0:8080
```

## 🔗 API接口

### 已实现的学校API接口：

#### 1. 获取学校列表
```
GET /api/schools/
```
**参数**：
- `type`: 学校类型 (primary/secondary)
- `category`: 学校分类 (elite/traditional/direct/government)
- `district`: 地区
- `applicationStatus`: 申请状态 (open/closed/deadline)
- `keyword`: 搜索关键词
- `page`: 页码 (默认1)
- `pageSize`: 每页大小 (默认20)

#### 2. 获取学校详情
```
GET /api/schools/{id}/
```

#### 3. 获取学校统计
```
GET /api/schools/stats/
```
**参数**：
- `type`: 学校类型 (可选)

### 响应格式
所有接口返回统一格式：
```json
{
  "code": 200,
  "message": "成功",
  "success": true,
  "data": { ... }
}
```

## 🧪 测试API

### 使用测试脚本
```bash
cd backend
python test_api.py
```

### 手动测试
```bash
# 获取所有学校
curl "http://localhost:8080/api/schools/"

# 获取中学列表
curl "http://localhost:8080/api/schools/?type=secondary"

# 获取学校详情
curl "http://localhost:8080/api/schools/1/"

# 获取统计信息
curl "http://localhost:8080/api/schools/stats/"
```

## 🔧 CORS配置

已配置允许前端访问的地址：
- `http://localhost:3000` (React默认端口)
- `http://localhost:5173` (Vite默认端口)
- `http://127.0.0.1:3000`
- `http://127.0.0.1:5173`

## 📊 Mock数据

当前使用与前端一致的Mock数据：
- **中学**: 圣保罗男女中学、喇沙书院、拔萃女书院
- **小学**: 拔萃女小学、圣保罗男女中学附属小学、喇沙小学

## 🔄 前后端联调

### 1. 启动后端服务
```bash
cd backend
python manage.py runserver 0.0.0.0:8080
```

### 2. 配置前端连接API
在前端项目根目录创建 `.env.local` 文件：
```bash
VITE_API_BASE_URL=http://localhost:8080/api
VITE_ENABLE_MOCK=false
```

### 3. 启动前端
```bash
cd frontend
npm run dev
```

### 4. 验证连接
- 前端应该不再显示"Mock模式"指示器
- 数据来源于后端API
- 网络面板可以看到API请求

## ⚠️ 常见问题

### 问题1: ImportError django.conf.urls url
**解决**: 已修复，使用 `django.urls.re_path` 替代

### 问题2: CORS错误
**解决**: 已配置CORS，确保前端地址在白名单中

### 问题3: 数据库连接错误
**解决**: 检查 `config/conf/dev/backend/settings.json` 配置

### 问题4: Redis连接错误
**解决**: 确保Redis服务运行，或临时禁用缓存

## 📈 下一步扩展

- 连接真实数据库
- 添加用户认证
- 实现数据管理后台
- 添加日志和监控
- 部署到生产环境

## 🎯 成功标识

当看到以下信息表示启动成功：
```
System check identified no issues (0 silenced).
Django version 4.x.x, using settings 'backend.settings'
Starting development server at http://0.0.0.0:8080/
Quit the server with CONTROL-C.
```

访问 `http://localhost:8080/api/schools/` 应该返回JSON格式的学校数据。 