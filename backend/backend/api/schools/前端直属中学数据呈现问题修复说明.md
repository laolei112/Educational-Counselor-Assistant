# å‰ç«¯ç›´å±ä¸­å­¦æ•°æ®å‘ˆç°é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ¯ é—®é¢˜æè¿°

å‰ç«¯æ— æ³•æ­£ç¡®æ˜¾ç¤ºå°å­¦çš„ç›´å±ä¸­å­¦æ•°æ®ï¼Œå¯¼è‡´å®¶é•¿æ— æ³•çœ‹åˆ°å°å­¦çš„å‡å­¦è”ç³»ä¿¡æ¯ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. æ•°æ®ç»“æ„ä¸åŒ¹é…

**åç«¯è¿”å›æ ¼å¼**:
```python
# get_linked_secondary_schools() æ–¹æ³•è¿”å›
[
    {'name': 'åœ£ä¿ç½—ç”·å¥³ä¸­å­¦', 'type': 'ä¸€æ¡é¾™'},
    {'name': 'åœ£ä¿ç½—ä¹¦é™¢', 'type': 'ç›´å±'},
    {'name': 'åœ£ä¿ç½—å­¦æ ¡', 'type': 'è”ç³»'}
]
```

**å‰ç«¯æœŸæœ›æ ¼å¼**:
```typescript
// School æ¥å£å®šä¹‰
linkedSchools?: string[]  // æœŸæœ›å­—ç¬¦ä¸²æ•°ç»„

// å‰ç«¯ç»„ä»¶ä½¿ç”¨
<div v-if="school.linkedSchools && school.linkedSchools.length" class="linked-schools">
  ç›´å±ä¸­å­¦ï¼š{{ school.linkedSchools.join('ã€') }}
</div>
```

### 2. ç±»å‹ä¸åŒ¹é…

- **åç«¯**: è¿”å›å¯¹è±¡æ•°ç»„ `Array<{name: string, type: string}>`
- **å‰ç«¯**: æœŸæœ›å­—ç¬¦ä¸²æ•°ç»„ `Array<string>`

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹åç«¯APIåºåˆ—åŒ–

**ä¼˜åŒ–ç‰ˆAPI (`primary_views_optimized.py`)**:
```python
# ä¿®æ”¹å‰
"linkedSchools": linked_schools,

# ä¿®æ”¹å
"linkedSchools": [school['name'] for school in linked_schools] if linked_schools else [],
```

**æ ‡å‡†ç‰ˆAPI (`primary_views.py`)**:
```python
# ä¿®æ”¹å‰
"linkedSchools": linked_schools,

# ä¿®æ”¹å
"linkedSchools": [school['name'] for school in linked_schools] if linked_schools else [],
```

### 2. æ•°æ®è½¬æ¢é€»è¾‘

```python
# è·å–å…³è”ä¸­å­¦ï¼ˆå¯¹è±¡æ•°ç»„ï¼‰
linked_schools = school.get_linked_secondary_schools()
# ç»“æœ: [{'name': 'åœ£ä¿ç½—ç”·å¥³ä¸­å­¦', 'type': 'ä¸€æ¡é¾™'}, ...]

# è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°ç»„
linked_school_names = [school['name'] for school in linked_schools] if linked_schools else []
# ç»“æœ: ['åœ£ä¿ç½—ç”·å¥³ä¸­å­¦', 'åœ£ä¿ç½—ä¹¦é™¢', 'åœ£ä¿ç½—å­¦æ ¡']
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### 1. APIå“åº”æ ¼å¼

**ä¿®å¤å‰**:
```json
{
  "linkedSchools": [
    {"name": "åœ£ä¿ç½—ç”·å¥³ä¸­å­¦", "type": "ä¸€æ¡é¾™"},
    {"name": "åœ£ä¿ç½—ä¹¦é™¢", "type": "ç›´å±"}
  ]
}
```

**ä¿®å¤å**:
```json
{
  "linkedSchools": [
    "åœ£ä¿ç½—ç”·å¥³ä¸­å­¦",
    "åœ£ä¿ç½—ä¹¦é™¢"
  ]
}
```

### 2. å‰ç«¯æ˜¾ç¤ºæ•ˆæœ

**ä¿®å¤å‰**:
```
ç›´å±ä¸­å­¦ï¼š[object Object]ã€[object Object]
```

**ä¿®å¤å**:
```
ç›´å±ä¸­å­¦ï¼šåœ£ä¿ç½—ç”·å¥³ä¸­å­¦ã€åœ£ä¿ç½—ä¹¦é™¢
```

## ğŸ¯ åŠŸèƒ½éªŒè¯

### 1. æ•°æ®å®Œæ•´æ€§

**ä¿ç•™çš„ä¿¡æ¯**:
- âœ… ä¸­å­¦åç§°ï¼šå®Œæ•´ä¿ç•™
- âœ… æ•°æ®æ¥æºï¼šæ¥è‡ª `secondary_info` JSONå­—æ®µ
- âœ… è¿‡æ»¤é€»è¾‘ï¼šè‡ªåŠ¨è¿‡æ»¤ç©ºå€¼å’Œ"-"å€¼

**ä¸¢å¤±çš„ä¿¡æ¯**:
- âŒ ä¸­å­¦ç±»å‹ï¼šä¸€æ¡é¾™/ç›´å±/è”ç³»ï¼ˆå‰ç«¯æš‚ä¸éœ€è¦ï¼‰

### 2. å‰ç«¯å…¼å®¹æ€§

**ç»„ä»¶æ¸²æŸ“**:
```vue
<div v-if="school.linkedSchools && school.linkedSchools.length" class="linked-schools">
  ç›´å±ä¸­å­¦ï¼š{{ school.linkedSchools.join('ã€') }}
</div>
```

**ç±»å‹å®‰å…¨**:
```typescript
interface School {
  linkedSchools?: string[]  // ç°åœ¨å®Œå…¨åŒ¹é…
}
```

## ğŸš€ æ‰©å±•å»ºè®®

### 1. å¦‚æœéœ€è¦æ˜¾ç¤ºä¸­å­¦ç±»å‹

**æ–¹æ¡ˆA: ä¿®æ”¹å‰ç«¯ç±»å‹å®šä¹‰**
```typescript
interface School {
  linkedSchools?: Array<{
    name: string
    type: 'ä¸€æ¡é¾™' | 'ç›´å±' | 'è”ç³»'
  }>
}
```

**æ–¹æ¡ˆB: æ·»åŠ ç±»å‹ä¿¡æ¯å­—æ®µ**
```python
# åç«¯API
"linkedSchools": [school['name'] for school in linked_schools],
"linkedSchoolsWithType": linked_schools,  # ä¿ç•™å®Œæ•´ä¿¡æ¯
```

### 2. æ•°æ®å¢å¼º

**æ·»åŠ ä¸­å­¦è¯¦ç»†ä¿¡æ¯**:
```python
def get_linked_secondary_schools_detailed(self):
    """
    è·å–å…³è”ä¸­å­¦çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…å«Bandä¿¡æ¯ï¼‰
    """
    linked_schools = self.get_linked_secondary_schools()
    detailed_schools = []
    
    for school_info in linked_schools:
        # æŸ¥è¯¢ä¸­å­¦çš„Bandä¿¡æ¯
        secondary_school = TbSecondarySchools.objects.filter(
            school_name=school_info['name']
        ).first()
        
        detailed_info = {
            'name': school_info['name'],
            'type': school_info['type'],
            'band': secondary_school.school_group if secondary_school else None
        }
        detailed_schools.append(detailed_info)
    
    return detailed_schools
```

## ğŸ“‹ æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**:
```python
# æµ‹è¯•æœ‰ç›´å±ä¸­å­¦çš„å°å­¦
school = TbPrimarySchools.objects.filter(
    secondary_info__isnull=False
).first()

linked_schools = school.get_linked_secondary_schools()
assert isinstance(linked_schools, list)
assert all(isinstance(school, dict) for school in linked_schools)

# æµ‹è¯•APIå“åº”
response = client.get('/api/schools/primary/')
data = response.json()
assert isinstance(data['data']['list'][0]['linkedSchools'], list)
assert all(isinstance(name, str) for name in data['data']['list'][0]['linkedSchools'])
```

### 2. å‰ç«¯æµ‹è¯•

**ç»„ä»¶æµ‹è¯•**:
```vue
<template>
  <div v-for="school in schools" :key="school.id">
    <div v-if="school.linkedSchools?.length">
      ç›´å±ä¸­å­¦ï¼š{{ school.linkedSchools.join('ã€') }}
    </div>
  </div>
</template>
```

## ğŸ‰ ä¿®å¤æ€»ç»“

### 1. é—®é¢˜æ ¹æº

- âœ… **æ•°æ®ç»“æ„ä¸åŒ¹é…**: åç«¯è¿”å›å¯¹è±¡æ•°ç»„ï¼Œå‰ç«¯æœŸæœ›å­—ç¬¦ä¸²æ•°ç»„
- âœ… **ç±»å‹å®šä¹‰ä¸ä¸€è‡´**: TypeScriptæ¥å£ä¸APIå“åº”ä¸åŒ¹é…

### 2. ä¿®å¤æ–¹æ¡ˆ

- âœ… **åç«¯é€‚é…**: ä¿®æ”¹APIåºåˆ—åŒ–ï¼Œè½¬æ¢ä¸ºå‰ç«¯æœŸæœ›æ ¼å¼
- âœ… **ä¿æŒå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œåªæ”¹å˜æ•°æ®æ ¼å¼

### 3. ä¿®å¤æ•ˆæœ

- âœ… **æ•°æ®å‘ˆç°**: å‰ç«¯èƒ½æ­£ç¡®æ˜¾ç¤ºç›´å±ä¸­å­¦åç§°
- âœ… **ç”¨æˆ·ä½“éªŒ**: å®¶é•¿èƒ½çœ‹åˆ°å®Œæ•´çš„å°å­¦å‡å­¦è”ç³»ä¿¡æ¯
- âœ… **ç±»å‹å®‰å…¨**: å‰åç«¯æ•°æ®ç±»å‹å®Œå…¨åŒ¹é…

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-25  
**ä¿®æ”¹æ–‡ä»¶**: primary_views.py, primary_views_optimized.py  
**é—®é¢˜ç±»å‹**: æ•°æ®ç»“æ„ä¸åŒ¹é…  
**ä¿®å¤æ–¹æ¡ˆ**: APIåºåˆ—åŒ–é€‚é…  
**å½±å“èŒƒå›´**: å°å­¦APIçš„linkedSchoolså­—æ®µ
