# å‰ç«¯ä»£ç æ··æ·† - å¿«é€Ÿå¯ç”¨æŒ‡å—

## âš¡ 3åˆ†é’Ÿå¯ç”¨ä»£ç æ··æ·†

### æ­¥éª¤1: å®‰è£…ä¾èµ–ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
cd frontend
npm install
```

> âœ… `terser` ä¾èµ–å·²æ·»åŠ åˆ° `package.json`ï¼Œè¿è¡Œ `npm install` å³å¯å®‰è£…

### æ­¥éª¤2: é…ç½®å·²å®Œæˆï¼ˆ0åˆ†é’Ÿï¼‰

âœ… `vite.config.ts` å·²ç»é…ç½®å¥½æ··æ·†é€‰é¡¹ï¼š
- ä½¿ç”¨ Terser è¿›è¡Œä»£ç å‹ç¼©å’Œæ··æ·†
- ç§»é™¤æ‰€æœ‰ console è¾“å‡º
- æ··æ·†å˜é‡å
- ç§»é™¤æ³¨é‡Šå’Œè°ƒè¯•ä»£ç 
- å…³é—­ source mapï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### æ­¥éª¤3: æ„å»ºéªŒè¯ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# ç”Ÿäº§æ„å»ºï¼ˆè‡ªåŠ¨åº”ç”¨æ··æ·†ï¼‰
npm run build

# æŸ¥çœ‹æ„å»ºäº§ç‰©
ls -lh dist/assets/

# æ£€æŸ¥ä»£ç æ˜¯å¦å·²æ··æ·†ï¼ˆåº”è¯¥çœ‹åˆ°éš¾ä»¥é˜…è¯»çš„ä»£ç ï¼‰
cat dist/assets/index-*.js | head -20
```

**æ··æ·†æˆåŠŸçš„ç‰¹å¾ï¼š**
```javascript
// æ··æ·†å‰
async function generateSignature(params) {
  const timestamp = getTimestamp()
  // ...
}

// æ··æ·†å
async function t(e){const n=o(),r=i(),...}
```

### æ­¥éª¤4: éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

```bash
# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨ï¼ˆä¼šä½¿ç”¨æ··æ·†åçš„ä»£ç ï¼‰
docker-compose up -d --build

# éªŒè¯
curl https://yourdomain.com
```

## ğŸ” éªŒè¯æ··æ·†æ•ˆæœ

### æ–¹æ³•1: æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. æ‰“å¼€ç½‘ç«™ï¼š`https://yourdomain.com`
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° `Sources` æ ‡ç­¾
4. æŸ¥çœ‹ JS æ–‡ä»¶ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - âœ… å˜é‡åæ˜¯ a, b, c, t0 ç­‰çŸ­åç§°
   - âœ… æ²¡æœ‰æ³¨é‡Š
   - âœ… ä»£ç ç´§å‡‘éš¾è¯»
   - âœ… æ²¡æœ‰ console.log

### æ–¹æ³•2: å‘½ä»¤è¡Œæ£€æŸ¥

```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæ··æ·†åä¼šæ›´å°ï¼‰
du -h dist/assets/*.js

# æœç´¢æ˜¯å¦è¿˜æœ‰console.logï¼ˆä¸åº”è¯¥æœ‰ï¼‰
grep -r "console.log" dist/assets/

# æŸ¥çœ‹æ˜¯å¦æœ‰source mapï¼ˆä¸åº”è¯¥æœ‰.mapæ–‡ä»¶ï¼‰
ls dist/assets/*.map 2>/dev/null || echo "âœ… æ²¡æœ‰source mapæ–‡ä»¶"
```

### æ–¹æ³•3: å¯¹æ¯”æ„å»ºäº§ç‰©

```bash
# åˆ›å»ºå¯¹æ¯”æ–‡ä»¶
cat dist/assets/index-*.js > /tmp/minified.js
wc -l /tmp/minified.js  # åº”è¯¥åªæœ‰å‡ è¡Œ

# æ£€æŸ¥ä»£ç å¯†åº¦
echo "æ–‡ä»¶å¤§å°: $(du -h /tmp/minified.js | cut -f1)"
echo "ä»£ç è¡Œæ•°: $(wc -l < /tmp/minified.js)"
```

## ğŸ“Š æ··æ·†é…ç½®è¯´æ˜

### å½“å‰é…ç½®ï¼ˆvite.config.tsï¼‰

```typescript
build: {
  minify: 'terser',           // âœ… ä½¿ç”¨ Terser æ··æ·†
  terserOptions: {
    compress: {
      drop_console: true,     // âœ… ç§»é™¤ console.*
      drop_debugger: true     // âœ… ç§»é™¤ debugger
    },
    mangle: {
      toplevel: true          // âœ… æ··æ·†é¡¶å±‚å˜é‡å
    },
    format: {
      comments: false         // âœ… ç§»é™¤æ³¨é‡Š
    }
  },
  sourcemap: false,           // âœ… å…³é—­ source map
  rollupOptions: {
    output: {
      chunkFileNames: 'assets/[name]-[hash].js',  // âœ… æ–‡ä»¶åhashåŒ–
      entryFileNames: 'assets/[name]-[hash].js',
      assetFileNames: 'assets/[name]-[hash].[ext]'
    }
  }
}
```

### å®‰å…¨ç­‰çº§

| ç‰¹æ€§ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ä»£ç å‹ç¼© | âœ… å¯ç”¨ | å‡å°æ–‡ä»¶ä½“ç§¯ |
| å˜é‡æ··æ·† | âœ… å¯ç”¨ | å˜é‡åâ†’a,b,c |
| ç§»é™¤è°ƒè¯• | âœ… å¯ç”¨ | æ— console/debugger |
| æ–‡ä»¶åæ··æ·† | âœ… å¯ç”¨ | å¸¦hashçš„éšæœºå |
| Source Map | âœ… ç¦ç”¨ | é˜²æ­¢æºç æ³„éœ² |

## ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤æ•ˆæœ

### æ··æ·†å‰çš„é£é™©
```javascript
// crypto.ts - æ”»å‡»è€…å¯ä»¥è½»æ¾çœ‹åˆ°
const API_SECRET = 'your-secret-key'
async function generateSignature(params, body) {
  const signString = `${timestamp}${nonce}${API_SECRET}...`
  return await sha256(signString)
}
```

### æ··æ·†åçš„ä¿æŠ¤
```javascript
// éš¾ä»¥é˜…è¯»å’Œç†è§£
const a="...";async function t(e,n){const r=o(),i=c(),s=await d(`${r}${i}${a}...`);return await u(s)}
```

**é˜²æŠ¤æ•ˆæœï¼š**
- ğŸ”’ ç­¾åç®—æ³•éš¾ä»¥ç†è§£
- ğŸ”’ å˜é‡ä½œç”¨éš¾ä»¥è¿½è¸ª  
- ğŸ”’ ä»£ç é€»è¾‘éš¾ä»¥åˆ†æ
- ğŸ”’ éœ€è¦å¤§é‡æ—¶é—´æ‰èƒ½é€†å‘

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: æ··æ·†ååŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Ÿ

**A:** æ˜¯çš„ï¼Œæ··æ·†åªæ”¹å˜ä»£ç å½¢å¼ï¼Œä¸æ”¹å˜åŠŸèƒ½ã€‚ä½†å»ºè®®ï¼š
```bash
# æœ¬åœ°éªŒè¯
npm run build
npm run preview  # é¢„è§ˆç”Ÿäº§æ„å»º

# æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
# - æœç´¢å­¦æ ¡
# - æŸ¥çœ‹è¯¦æƒ…
# - ç­›é€‰åŠŸèƒ½
```

### Q2: èƒ½å¦è°ƒè¯•æ··æ·†åçš„ä»£ç ï¼Ÿ

**A:** å¼€å‘ç¯å¢ƒä¸æ··æ·†ï¼Œç”Ÿäº§ç¯å¢ƒæ··æ·†ï¼š
```bash
# å¼€å‘ç¯å¢ƒï¼ˆä¸æ··æ·†ï¼‰
npm run dev

# ç”Ÿäº§æ„å»ºï¼ˆæ··æ·†ï¼‰
npm run build
```

### Q3: æ··æ·†åæ€§èƒ½æ˜¯å¦ä¸‹é™ï¼Ÿ

**A:** ä¸ä¼šï¼Œåè€Œä¼šæå‡ï¼š
- âœ… æ–‡ä»¶æ›´å°ï¼ŒåŠ è½½æ›´å¿«
- âœ… å˜é‡åæ›´çŸ­ï¼Œæ‰§è¡Œæ›´å¿«
- âœ… å»é™¤å†—ä½™ä»£ç 

### Q4: èƒ½å¦ä½¿ç”¨æ›´å¼ºçš„æ··æ·†ï¼Ÿ

**A:** å¯ä»¥ï¼Œå‚è€ƒ `å‰ç«¯ä»£ç æ··æ·†é…ç½®è¯´æ˜.md` ä¸­çš„é«˜çº§é…ç½®ï¼š
```bash
# å®‰è£…é«˜å¼ºåº¦æ··æ·†æ’ä»¶
npm install -D vite-plugin-obfuscator

# é…ç½® vite.config.tsï¼ˆå‚è€ƒæ–‡æ¡£ï¼‰
```

### Q5: Dockeræ„å»ºä¼šè‡ªåŠ¨æ··æ·†å—ï¼Ÿ

**A:** æ˜¯çš„ï¼ŒDockerfileä¸­çš„æ„å»ºå‘½ä»¤ä¼šè‡ªåŠ¨åº”ç”¨æ··æ·†ï¼š
```dockerfile
RUN npm run build  # ä½¿ç”¨æ··æ·†é…ç½®æ„å»º
```

## ğŸ”„ å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ

### å¼€å‘ç¯å¢ƒï¼ˆä¸æ··æ·†ï¼‰
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# ç‰¹ç‚¹ï¼š
# - ä»£ç å¯è¯»
# - æœ‰source map
# - ä¿ç•™console.log
# - å®æ—¶çƒ­æ›´æ–°
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆæ··æ·†ï¼‰
```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# ç‰¹ç‚¹ï¼š
# - ä»£ç æ··æ·†
# - æ— source map
# - ç§»é™¤console
# - ä¼˜åŒ–ä½“ç§¯
```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] âœ… `npm install` å·²æ‰§è¡Œï¼ˆå®‰è£…terserï¼‰
- [ ] âœ… `npm run build` æ„å»ºæˆåŠŸ
- [ ] âœ… æ£€æŸ¥ `dist/assets/` ä¸­çš„JSæ–‡ä»¶å·²æ··æ·†
- [ ] âœ… æ²¡æœ‰ `.map` æ–‡ä»¶ï¼ˆsource mapå·²å…³é—­ï¼‰
- [ ] âœ… æœ¬åœ°é¢„è§ˆåŠŸèƒ½æ­£å¸¸ï¼ˆ`npm run preview`ï¼‰
- [ ] âœ… Dockeræ„å»ºæˆåŠŸ
- [ ] âœ… ç”Ÿäº§ç¯å¢ƒåŠŸèƒ½éªŒè¯

## ğŸ¯ æ··æ·†æ•ˆæœå¯¹æ¯”

### æ–‡ä»¶å¤§å°å¯¹æ¯”
```bash
# æœªæ··æ·†ï¼ˆä»…å‹ç¼©ï¼‰
index.js: 250KB

# Terseræ··æ·†
index.js: 180KB  # â†“ 28%

# é«˜å¼ºåº¦æ··æ·†
index.js: 200KB  # ç•¥å¤§ä½†æ›´å®‰å…¨
```

### ä»£ç è¡Œæ•°å¯¹æ¯”
```bash
# æºä»£ç 
crypto.ts: 230è¡Œ

# æœªæ··æ·†æ„å»º
crypto-xxx.js: 150è¡Œ

# Terseræ··æ·†
crypto-xxx.js: 5è¡Œ  # å…¨éƒ¨å‹ç¼©æˆå‡ è¡Œ
```

## ğŸš€ ç«‹å³åº”ç”¨

### æœ€ç®€å•çš„æ–¹å¼

```bash
# 1. å®‰è£…ä¾èµ–
cd frontend && npm install

# 2. æ„å»ºï¼ˆè‡ªåŠ¨æ··æ·†ï¼‰
npm run build

# 3. éƒ¨ç½²
cd .. && docker-compose up -d --build
```

**å°±è¿™ä¹ˆç®€å•ï¼ä½ çš„å‰ç«¯ä»£ç ç°åœ¨å·²ç»è¢«æ··æ·†ä¿æŠ¤äº†ï¼** ğŸ‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†é…ç½®** â†’ `å‰ç«¯ä»£ç æ··æ·†é…ç½®è¯´æ˜.md`
- **å®‰å…¨æ–¹æ¡ˆ** â†’ `é˜²çˆ¬å–å’ŒåŠ å¯†æ–¹æ¡ˆè¯´æ˜.md`
- **éƒ¨ç½²æŒ‡å—** â†’ `é˜²çˆ¬å–éƒ¨ç½²æ£€æŸ¥æ¸…å•.md`

---

## âœ… å®Œæˆç¡®è®¤

æ··æ·†åŠŸèƒ½å¯ç”¨åï¼Œä½ çš„ç³»ç»Ÿå°†æ‹¥æœ‰ï¼š

1. âœ… **ä¼ è¾“åŠ å¯†** - HTTPS
2. âœ… **ä»£ç æ··æ·†** - Terser
3. âœ… **ç­¾åéªŒè¯** - åç«¯éªŒè¯
4. âœ… **é¢‘ç‡é™åˆ¶** - é˜²çˆ†ç ´
5. âœ… **åçˆ¬è™«** - è¡Œä¸ºæ£€æµ‹

**è¿™æ˜¯ä¸€ä¸ªéå¸¸å®Œå–„çš„å¤šå±‚æ¬¡é˜²æŠ¤ä½“ç³»ï¼** ğŸ›¡ï¸

---

*æœ€åæ›´æ–°: 2024-10-15*

