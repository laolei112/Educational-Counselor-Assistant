# 教学语言弹窗完整修复说明

## 问题汇总

### 问题1：PC端定位错误
**现象**：在 PC 端点击 ℹ️ 图标，弹窗显示在整个页面的中间，而不是在字段下方。

**原因**：768px 断点触发了 `position: fixed` 定位。

### 问题2：弹窗宽度受限
**现象**：弹窗宽度太窄，表格显示不完整。

**原因**：使用 `left: 0; right: 0;` 导致宽度受限于父元素。

## 完整解决方案

### 1. HTML 结构调整

```vue
<div class="info-item">  <!-- ✅ position: relative -->
  <label>
    教学语言
    <span class="info-icon" @click="...">ℹ️</span>
  </label>
  
  <div class="teaching-language-wrapper">
    <span>中英文并重</span>
  </div>
  
  <!-- ✅ 弹窗放在 info-item 内，wrapper 外 -->
  <div v-if="showLanguageInfo" class="language-info-popup">
    <!-- 表格内容 -->
  </div>
</div>
```

**关键点：**
- ✅ 弹窗是 `info-item` 的直接子元素
- ✅ `info-item` 有 `position: relative`
- ✅ 弹窗的 `position: absolute` 相对于 `info-item` 定位

### 2. CSS 定位设置

#### PC 端 / 平板（> 480px）
```css
.info-item {
  position: relative;  /* ✅ 定位参考点 */
}

.language-info-popup {
  position: absolute;
  top: 100%;           /* 在 info-item 下方 */
  left: 0;
  margin-top: 8px;
  min-width: 380px;    /* ✅ 固定最小宽度 */
  max-width: 500px;    /* ✅ 限制最大宽度 */
  z-index: 1000;       /* ✅ 确保在最上层 */
}
```

#### 手机端（≤ 480px）
```css
@media (max-width: 480px) {
  .language-info-popup {
    position: fixed;        /* 相对于屏幕 */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    min-width: auto;        /* ✅ 覆盖 PC 端设置 */
    max-width: 400px;
  }
}
```

### 3. 滚动穿透防护

#### CSS 方案
```css
.modal-container {
  overflow-y: auto;
  overscroll-behavior: contain;  /* 阻止滚动链 */
}
```

#### JavaScript 方案
```typescript
// 弹窗打开时禁用背景滚动
watch(() => props.visible, (newVisible) => {
  document.body.style.overflow = newVisible ? 'hidden' : ''
})

// 组件销毁时确保恢复
onUnmounted(() => {
  document.body.style.overflow = ''
})
```

## 定位层级关系

### DOM 层级
```
.modal-overlay (fixed)
  └─ .modal-container (relative)
       └─ .basic-info
            └─ .info-grid
                 └─ .info-item (relative) ← 定位参考点
                      ├─ label
                      ├─ .teaching-language-wrapper
                      └─ .language-info-popup (absolute) ← 相对于 info-item
```

### 定位计算
```
弹窗的 position: absolute
    ↓
查找最近的 positioned 祖先
    ↓
找到 .info-item (position: relative)
    ↓
相对于 .info-item 定位
    ↓
top: 100% → 在 .info-item 底部下方
left: 0   → 左对齐
```

## 视觉效果

### PC 端（> 480px）
```
┌─────────────────────────────────┐
│ 📋 基本信息                     │
│ ┌──────────┐  ┌──────────┐    │
│ │学校规模  │  │教学语言 ℹ│    │
│ │30班     │  │中英并重  │    │
│ └──────────┘  └──────────┘    │
│                     ↓           │
│              ┌─────────────────────────┐
│              │ 教学语言分类标准   [✕] │
│              ├─────────────────────────┤
│              │ ┏━━━━━━━━━━━━━━━━━━━┓ │
│              │ ┃ 分类 │ 占比 │ 说明 ┃ │
│              │ ┣━━━━━━━━━━━━━━━━━━━┫ │
│              │ ┃ ... 表格内容 ...  ┃ │
│              │ ┗━━━━━━━━━━━━━━━━━━━┛ │
│              └─────────────────────────┘
│ ┌──────────┐  ┌──────────┐    │
│ │  学费    │  │课程类型  │    │
└─────────────────────────────────┘
```
✅ 显示在教学语言字段下方，宽度 380-500px

### 手机端（≤ 480px）
```
          屏幕中央
    ┌─────────────────┐
    │ 教学语言分类... │
    │ ┌─────────────┐ │
    │ │   表格      │ │
    │ └─────────────┘ │
    └─────────────────┘
```
✅ 居中显示，宽度 90% (max 400px)

## 修复的关键点

### 1. 定位参考点
```css
.info-item {
  position: relative;  /* ✅ 关键：成为定位参考点 */
}
```

### 2. 弹窗宽度
```css
.language-info-popup {
  /* ❌ 之前：left: 0; right: 0; → 宽度受限 */
  /* ✅ 现在：left: 0; min-width: 380px; → 宽度固定 */
  min-width: 380px;
  max-width: 500px;
}
```

### 3. 层级优先级
```css
z-index: 1000;  /* ✅ 确保在所有内容之上 */
```

### 4. 断点调整
```css
/* ✅ PC 端 (> 480px)：absolute 定位 */
.language-info-popup { position: absolute; }

/* ✅ 手机端 (≤ 480px)：fixed 定位 */
@media (max-width: 480px) {
  .language-info-popup { position: fixed; }
}
```

## 测试验证

### PC 端测试步骤
1. 打开学校详情弹窗
2. 找到"教学语言"字段
3. 点击 ℹ️ 图标
4. **验证**：
   - ✅ 弹窗显示在教学语言字段正下方
   - ✅ 弹窗宽度约 380-500px
   - ✅ 表格内容完整显示
   - ✅ 不遮挡整个页面

### 平板测试步骤
1. 浏览器宽度设置为 481-768px
2. 打开详情，点击 ℹ️
3. **验证**：
   - ✅ 弹窗在字段下方
   - ✅ 定位正常

### 手机测试步骤
1. 浏览器宽度 ≤ 480px
2. 打开详情，点击 ℹ️
3. **验证**：
   - ✅ 弹窗居中显示
   - ✅ 宽度为屏幕的 90%

### 滚动测试
1. 在详情弹窗内滚动到底部
2. 继续向下滑动
3. **验证**：
   - ✅ 背景页面不滚动
   - ✅ 只有弹窗内部滚动

## 所有修改汇总

### HTML 结构
- ✅ 弹窗移至 info-item 内
- ✅ 弹窗在 wrapper 外

### CSS 样式
- ✅ info-item 添加 position: relative
- ✅ 弹窗设置 min-width 和 max-width
- ✅ 移除 right: 0
- ✅ z-index 提升到 1000
- ✅ 断点从 768px 改为 480px

### JavaScript 逻辑
- ✅ watch 监听 visible
- ✅ 控制 body overflow
- ✅ onUnmounted 恢复
- ✅ 添加 overscroll-behavior

### 滚动防护
- ✅ CSS: overscroll-behavior: contain
- ✅ JS: body overflow 控制

## 相关文件

**修改的文件：**
- `frontend/src/components/SchoolDetailModal.vue`

**核心修改：**
1. HTML 结构调整
2. CSS 定位和宽度优化
3. JavaScript 滚动控制
4. 响应式断点调整

## 总结

此次完整修复解决了教学语言弹窗的所有问题：

1. ✅ **PC 端定位正确** - 显示在字段下方
2. ✅ **宽度合适** - 380-500px，表格完整显示
3. ✅ **手机端优化** - 居中显示，易于阅读
4. ✅ **滚动隔离** - 防止滚动穿透

现在刷新页面，在 PC 端点击教学语言的 ℹ️ 图标，弹窗应该正确显示在字段下方了！

