# 小学中学接口分离说明

## 概述

为了更好地管理小学和中学数据，我们将小学和中学的接口进行了分离：

- **小学数据**：继续从 `tb_schools` 表读取（保持不变）
- **中学数据**：从新的 `tb_secondary_schools` 表读取（新增）

## 后端改动

### 1. 新增文件

#### ✅ `backend/backend/api/schools/secondary_views.py`
专门处理中学数据的视图函数，从 `tb_secondary_schools` 表读取数据。

**包含的函数**：
- `secondary_schools_list`: 获取中学列表
- `secondary_school_detail`: 获取中学详情
- `secondary_schools_stats`: 获取中学统计信息

**特性**：
- 支持按学校组别（schoolGroup）筛选
- 支持按性别（gender）筛选
- 支持按宗教（religion）筛选
- 支持关键词搜索（学校名称、地区、地址、类别等）
- 支持分页

### 2. 更新的文件

#### ✅ `backend/backend/api/schools/urls.py`
更新 URL 路由配置：

```python
# 小学接口（从 tb_schools 表读取）
re_path(r'^primary/$', views.primary_schools_list, name='primary_schools_list'),

# 中学接口（从 tb_secondary_schools 表读取）
re_path(r'^secondary/$', secondary_views.secondary_schools_list, name='secondary_schools_list'),
re_path(r'^secondary/stats/$', secondary_views.secondary_schools_stats, name='secondary_schools_stats'),
re_path(r'^secondary/(?P<school_id>\d+)/$', secondary_views.secondary_school_detail, name='secondary_school_detail'),
```

#### ✅ `backend/backend/api/schools/views.py`
移除了旧的 `secondary_schools_list` 函数（已迁移到 `secondary_views.py`）

## 前端改动

### 1. 更新的类型定义

#### ✅ `frontend/src/types/school.ts`
更新 `School` 接口，添加中学特有字段：

```typescript
export interface School {
  // ... 原有字段 ...
  
  // 中学特有字段 (tb_secondary_schools)
  schoolGroup?: string  // 学校组别 (1A, 1B, 2A, 2B等)
  transferOpenTime?: string  // 插班开放时间
  totalClasses?: number  // 全校总班数
  admissionInfo?: string  // 入学信息
  schoolCurriculum?: string  // 课程设置
  address?: string
  phone?: string
  email?: string
  website?: string
  officialWebsite?: string
  createdAt?: string
  updatedAt?: string
}
```

#### ✅ `frontend/src/api/types.ts`
更新 `PageQuery` 接口，添加中学特有查询参数：

```typescript
export interface PageQuery {
  // ... 原有参数 ...
  
  // 中学特有查询参数
  schoolGroup?: string  // 学校组别
  gender?: string  // 学生性别
  religion?: string  // 宗教
}
```

### 2. API 调用保持不变

前端的 API 调用方式保持不变，路由已在后端自动处理：

```typescript
// 获取小学列表 - 从 tb_schools 读取
SchoolApi.getPrimarySchools(query)

// 获取中学列表 - 从 tb_secondary_schools 读取
SchoolApi.getSecondarySchools(query)
```

## API 接口对比

### 小学接口（tb_schools）

#### 列表接口
```
GET /api/schools/primary?page=1&pageSize=20&keyword=拔萃
```

**支持的查询参数**：
- `page`: 页码
- `pageSize`: 每页数量
- `category`: 学校分类
- `district`: 地区
- `applicationStatus`: 申请状态
- `keyword`: 关键词搜索

**返回字段**：
```json
{
  "id": 1,
  "name": "拔萃男书院附属小学",
  "type": "primary",
  "category": "private",
  "district": "九龙城区",
  "schoolNet": "34",
  "tuition": 59860,
  "gender": "boys",
  "religion": "基督教",
  "applicationStatus": "open",
  "band1Rate": 85,
  "feederSchools": ["拔萃男书院"],
  "contact": {
    "address": "...",
    "phone": "...",
    "email": "...",
    "website": "..."
  }
}
```

### 中学接口（tb_secondary_schools）

#### 列表接口
```
GET /api/schools/secondary?page=1&pageSize=20&keyword=拔萃&schoolGroup=1A
```

**支持的查询参数**：
- `page`: 页码
- `pageSize`: 每页数量
- `category`: 学校类别（官立/资助/直资/私立）
- `district`: 地区
- `schoolGroup`: 学校组别（1A, 1B, 2A等）
- `gender`: 学生性别（男/女/男女）
- `religion`: 宗教
- `keyword`: 关键词搜索

**返回字段**：
```json
{
  "id": 1,
  "name": "拔萃男书院",
  "type": "secondary",
  "district": "九龙城区",
  "schoolNet": "34, 35, 41",
  "religion": "基督教",
  "gender": "男",
  "tuition": "$59860",
  "category": "直资",
  "schoolType": "直资",
  "schoolGroup": "1B",
  "transferOpenTime": null,
  "totalClasses": 36,
  "admissionInfo": "本校不参加中学学位分配办法...",
  "schoolCurriculum": "...",
  "contact": {
    "address": "九龙旺角亚皆老街131号",
    "phone": "27115191",
    "email": "dbsadmin@dbs.edu.hk",
    "website": "http://www.dbs.edu.hk"
  },
  "address": "九龙旺角亚皆老街131号",
  "phone": "27115191",
  "email": "dbsadmin@dbs.edu.hk",
  "website": "http://www.dbs.edu.hk",
  "applicationStatus": "open",
  "band1Rate": 0
}
```

#### 详情接口
```
GET /api/schools/secondary/{id}
```

#### 统计接口
```
GET /api/schools/secondary/stats
```

**返回数据**：
```json
{
  "totalSchools": 500,
  "districtStats": {
    "黄大仙区": 35,
    "九龙城区": 32,
    ...
  },
  "categoryStats": {
    "资助": 300,
    "直资": 120,
    ...
  },
  "groupStats": {
    "1A": 50,
    "1B": 80,
    ...
  },
  "genderStats": {
    "男女": 350,
    "男": 80,
    "女": 70
  }
}
```

## 数据库表对比

### tb_schools（小学）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| name | VARCHAR(255) | 学校名称 |
| level | ENUM | 学校级别（primary/secondary） |
| category | ENUM | 学校分类 |
| net_name | VARCHAR(100) | 校网 |
| religion | VARCHAR(50) | 宗教 |
| gender | ENUM | 性别 |
| district | VARCHAR(100) | 地区 |
| address | VARCHAR(500) | 地址 |
| official_website | VARCHAR(500) | 官网 |
| tuition | DECIMAL(10,2) | 学费 |
| promotion_rate | JSON | 升学比例 |
| application_status | ENUM | 申请状态 |

### tb_secondary_schools（中学）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| school_name | VARCHAR(100) | 学校名称 |
| district | VARCHAR(50) | 区域 |
| school_net | VARCHAR(50) | 对应校网 |
| religion | VARCHAR(50) | 宗教 |
| student_gender | VARCHAR(20) | 学生性别 |
| tuition | VARCHAR(200) | 学费 |
| school_category | VARCHAR(50) | 学校类别 |
| school_group | VARCHAR(20) | 学校组别 |
| transfer_open_time | VARCHAR(100) | 插班开放时间 |
| total_classes | INT | 全校总班数 |
| admission_info | TEXT | 入学信息 |
| school_curriculum | TEXT | 课程设置 |
| address | VARCHAR(200) | 地址 |
| phone | VARCHAR(20) | 电话 |
| email | VARCHAR(100) | 邮箱 |
| website | VARCHAR(200) | 网站 |

## 字段映射关系

| 前端字段 | 小学表字段 | 中学表字段 |
|---------|-----------|-----------|
| name | name | school_name |
| district | district | district |
| schoolNet | net_name | school_net |
| religion | religion | religion |
| gender | gender | student_gender |
| tuition | tuition | tuition |
| category | category | school_category |
| address | address | address |
| phone | promotion_rate.phone | phone |
| email | promotion_rate.email | email |
| website | official_website | website |
| schoolGroup | - | school_group |
| totalClasses | - | total_classes |
| admissionInfo | - | admission_info |
| schoolCurriculum | - | school_curriculum |

## 使用示例

### 前端调用示例

```typescript
import { SchoolApi } from '@/api/school'

// 获取小学列表（从 tb_schools）
const primarySchools = await SchoolApi.getPrimarySchools({
  page: 1,
  pageSize: 20,
  district: '九龙城区',
  keyword: '拔萃'
})

// 获取中学列表（从 tb_secondary_schools）
const secondarySchools = await SchoolApi.getSecondarySchools({
  page: 1,
  pageSize: 20,
  district: '九龙城区',
  schoolGroup: '1A',  // 中学特有参数
  gender: '男女',      // 中学特有参数
  keyword: '拔萃'
})

// 获取中学详情
const schoolDetail = await fetch('/api/schools/secondary/1')

// 获取中学统计
const stats = await fetch('/api/schools/secondary/stats')
```

### 后端调用示例

```python
from backend.models.tb_schools import TbSchools
from backend.models.tb_secondary_schools import TbSecondarySchools

# 查询小学
primary_schools = TbSchools.objects.filter(level='primary', district='九龙城区')

# 查询中学
secondary_schools = TbSecondarySchools.objects.filter(
    district='九龙城区',
    school_group='1A',
    student_gender='男女'
)
```

## 迁移步骤

### 1. 后端迁移

1. ✅ 创建 `tb_secondary_schools` 表
2. ✅ 创建 `TbSecondarySchools` ORM 模型
3. ✅ 导入中学数据到新表
4. ✅ 创建 `secondary_views.py` 处理中学接口
5. ✅ 更新 URL 路由配置

### 2. 前端适配

1. ✅ 更新类型定义（添加中学特有字段）
2. ✅ 更新查询参数类型
3. ⏳ 测试前端调用（确认数据正确显示）

### 3. 测试验证

```bash
# 测试小学接口
curl "http://localhost:8000/api/schools/primary?page=1&pageSize=10"

# 测试中学接口
curl "http://localhost:8000/api/schools/secondary?page=1&pageSize=10"

# 测试中学详情
curl "http://localhost:8000/api/schools/secondary/1"

# 测试中学统计
curl "http://localhost:8000/api/schools/secondary/stats"
```

## 注意事项

1. **向后兼容**：小学接口保持不变，现有功能不受影响
2. **数据一致性**：中学数据完全从新表读取，确保数据独立
3. **字段映射**：前端需要注意字段名称的差异（如 `name` vs `school_name`）
4. **查询参数**：中学接口支持更多的筛选参数（schoolGroup, gender等）
5. **性能**：两个表独立查询，互不影响性能

## 优势

1. **数据分离**：小学和中学数据独立管理，互不影响
2. **灵活扩展**：可以为中学添加更多特有字段和功能
3. **性能优化**：独立的表和索引，提高查询效率
4. **维护简便**：代码结构清晰，易于维护和扩展

## 下一步

1. 测试前端页面，确认中学数据正确显示
2. 添加中学特有的筛选功能（按组别、性别等）
3. 完善中学详情页面，展示更多信息
4. 导入完整的中学数据

